(()=>{"use strict";var e,t,s,i,n,a,o,r,h,l,c,d,u;!function(e){e.KEYBOARD="keyboard",e.MOUSE="mouse",e.TOUCH="touch"}(e||(e={})),function(e){e[e.LEFT=0]="LEFT",e[e.MIDDLE=1]="MIDDLE",e[e.RIGHT=2]="RIGHT"}(t||(t={})),function(e){e.BEGAN="began",e.MOVED="moved",e.STATIONARY="stationary",e.ENDED="ended",e.CANCELED="canceled"}(s||(s={})),function(e){e.BOX="box",e.CIRCLE="circle",e.POLYGON="polygon"}(i||(i={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.PLAYER=1]="PLAYER",e[e.ENEMY=2]="ENEMY",e[e.PROJECTILE=3]="PROJECTILE",e[e.ENVIRONMENT=4]="ENVIRONMENT",e[e.TRIGGER=5]="TRIGGER",e[e.UI=6]="UI",e[e.GROUND=7]="GROUND",e[e.ALL=8]="ALL"}(n||(n={})),function(e){e.IMAGE="image",e.AUDIO="audio",e.TEXT="text",e.JSON="json",e.FONT="font"}(a||(a={})),function(e){e.NOT_LOADED="not_loaded",e.LOADING="loading",e.LOADED="loaded",e.ERROR="error"}(o||(o={})),function(e){e.NOT_LOADED="not_loaded",e.LOADING="loading",e.LOADED="loaded",e.UNLOADING="unloading"}(r||(r={})),function(e){e.PLAYING="playing",e.PAUSED="paused",e.GAMEOVER="game_over",e.RESTART="restart"}(h||(h={})),function(e){e.ORTHOGRAPHIC="orthographic",e.PERSPECTIVE="perspective"}(l||(l={})),function(e){e.CAPTURE="capture",e.TARGET="target",e.BUBBLE="bubble"}(c||(c={})),function(e){e.TOP_LEFT="top_left",e.TOP_CENTER="top_center",e.TOP_RIGHT="top_right",e.MIDDLE_LEFT="middle_left",e.MIDDLE_CENTER="middle_center",e.MIDDLE_RIGHT="middle_right",e.BOTTOM_LEFT="bottom_left",e.BOTTOM_CENTER="bottom_center",e.BOTTOM_RIGHT="bottom_right"}(d||(d={})),function(e){e.NORMAL="normal",e.HOVERED="hovered",e.PRESSED="pressed",e.DISABLED="disabled"}(u||(u={}));const g="trigger_enter",m="collision_enter",p="collision_exit";var E,T;!function(e){e.FADE_IN="fade_in",e.FADE_OUT="fade_out",e.SLIDE_IN_FROM_TOP="slide_in_from_top",e.SLIDE_IN_FROM_BOTTOM="slide_in_from_bottom",e.SLIDE_IN_FROM_LEFT="slide_in_from_left",e.SLIDE_IN_FROM_RIGHT="slide_in_from_right",e.SLIDE_OUT_TO_TOP="slide_out_to_top",e.SLIDE_OUT_TO_BOTTOM="slide_out_to_bottom",e.SLIDE_OUT_TO_LEFT="slide_out_to_left",e.SLIDE_OUT_TO_RIGHT="slide_out_to_right",e.SCALE_IN="scale_in",e.SCALE_OUT="scale_out",e.BOUNCE="bounce",e.PULSE="pulse",e.SHAKE="shake",e.FadeIn="FadeIn"}(E||(E={})),function(e){e.EXPLOSION="explosion",e.STARS="stars",e.SPARKLES="sparkles",e.SMOKE="smoke",e.FIRE="fire",e.CONFETTI="confetti",e.HEARTS="hearts",e.SNOW="snow"}(T||(T={}));class y{static get deltaTime(){return this._deltaTime*this._timeScale}static get unscaledDeltaTime(){return this._unscaledDeltaTime}static get totalTime(){return this._totalTime}static get timeScale(){return this._timeScale}static set timeScale(e){this._timeScale=Math.max(0,e)}static get frameCount(){return this._frameCount}static get fps(){return this._fps}static update(e){this._unscaledDeltaTime=e,this._deltaTime=e,this._totalTime+=e,this._frameCount++,this._fpsFrameCount++;const t=this._totalTime;t-this._lastFpsUpdate>=1e3&&(this._fps=Math.round(1e3*this._fpsFrameCount/(t-this._lastFpsUpdate)),this._fpsFrameCount=0,this._lastFpsUpdate=t)}static reset(){this._deltaTime=0,this._unscaledDeltaTime=0,this._totalTime=0,this._frameCount=0,this._fps=0,this._lastFpsUpdate=0,this._fpsFrameCount=0}}y._deltaTime=0,y._unscaledDeltaTime=0,y._totalTime=0,y._timeScale=1,y._frameCount=0,y._fps=0,y._lastFpsUpdate=0,y._fpsFrameCount=0;class A{constructor(e,t={}){this.defaultPrevented=!1,this._propagationStopped=!1,this.type=e,this.bubbles=t.bubbles||!1,this.cancelable=t.cancelable||!1,this.data=t.data,this.timeStamp=y.totalTime,this.phase=c.TARGET}preventDefault(){this.cancelable&&(this.defaultPrevented=!0)}stopPropagation(){this._propagationStopped=!0}stopImmediatePropagation(){this._propagationStopped=!0}get propagationStopped(){return this._propagationStopped}}class O{constructor(){this.events=new Map}addEventListener(e,t,s={}){this.events.has(e)||this.events.set(e,[]);const i=this.events.get(e);if(!i)throw new Error(`Event type "${e}" not found in event map.`);i.push({listener:t,options:s}),i.sort((e,t)=>(t.options.priority||0)-(e.options.priority||0))}removeEventListener(e,t){const s=this.events.get(e);if(s){const e=s.findIndex(e=>e.listener===t);-1!==e&&s.splice(e,1)}}dispatchEvent(e,t){const s="string"==typeof e?new A(e,{data:t}):e;s.target||(s.target=this),s.currentTarget=this;const i=this.events.get(s.type);if(i)for(const{listener:e,options:t}of i)try{e.call(this,s),t.once&&this.removeEventListener(s.type,e)}catch(e){console.error("Error in event listener:",e)}return!s.defaultPrevented}removeAllEventListeners(e){e?this.events.delete(e):this.events.clear()}}var f=function(e,t,s,i){return new(s||(s=Promise))(function(n,a){function o(e){try{h(i.next(e))}catch(e){a(e)}}function r(e){try{h(i.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,r)}h((i=i.apply(e,t||[])).next())})};class S extends O{constructor(){super(),this.audioContext=null,this.masterGainNode=null,this.clips=new Map,this.activeSources=new Set,this.bgmSource=null,this.bgmName=null,this.masterVolume=1,this.enabled=!0,this.initializeAudioContext()}initializeAudioContext(){var e;try{const t=null!==(e=window.AudioContext)&&void 0!==e?e:window.webkitAudioContext;if(!t)throw new Error("Web Audio API not supported");this.audioContext=new t,this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.connect(this.audioContext.destination),document.addEventListener("click",this.resumeAudioContext.bind(this),{once:!0}),document.addEventListener("keydown",this.resumeAudioContext.bind(this),{once:!0})}catch(e){console.warn("Web Audio API not supported:",e)}}resumeAudioContext(){return f(this,void 0,void 0,function*(){if(this.audioContext&&"suspended"===this.audioContext.state)try{yield this.audioContext.resume()}catch(e){console.error("Failed to resume audio context:",e)}})}playBackgroundMusic(e,t={}){var s,i;if(this.bgmName=e,this.stopBackgroundMusic(),!this.enabled)return;const n=this.clips.get(e);if(n)try{if(!this.audioContext||!this.masterGainNode)return;const e=this.audioContext.createBufferSource(),a=this.audioContext.createGain();e.buffer=n.buffer,e.loop=null===(s=t.loop)||void 0===s||s,a.gain.value=(null!==(i=t.volume)&&void 0!==i?i:n.volume)*this.masterVolume,e.connect(a),a.connect(this.masterGainNode);const o={clip:n,source:e,gainNode:a,isPlaying:!0};this.bgmSource=o,e.onended=()=>{this.bgmSource===o&&(this.bgmSource=null)},e.start()}catch(t){console.error(`Failed to play background music: ${e}`,t)}}stopBackgroundMusic(){this.bgmSource&&this.bgmSource.isPlaying&&(this.bgmSource.source.stop(),this.bgmSource.isPlaying=!1,this.bgmSource=null)}loadSound(e,t){return f(this,void 0,void 0,function*(){if(!this.audioContext)throw new Error("Audio context not available");try{const s=yield fetch(t),i=yield s.arrayBuffer(),n=yield this.audioContext.decodeAudioData(i),a={name:e,buffer:n,volume:1,loop:!1};this.clips.set(e,a),this.dispatchEvent("audio_clip_loaded",{clip:a})}catch(t){throw console.error(`Failed to load audio clip: ${e}`,t),t}})}playSound(e,t=!1,s={}){var i,n;if(!this.enabled||!this.audioContext||!this.masterGainNode)return;if(!t&&this.activeSources.size>0)for(const t of this.activeSources)if(t.clip.name===e&&t.isPlaying)return;const a=this.clips.get(e);if(a)try{const e=this.audioContext.createBufferSource(),t=this.audioContext.createGain();e.buffer=a.buffer,e.loop=null!==(i=s.loop)&&void 0!==i?i:a.loop;const o=(null!==(n=s.volume)&&void 0!==n?n:a.volume)*this.masterVolume;t.gain.value=o,e.connect(t),t.connect(this.masterGainNode);const r={clip:a,source:e,gainNode:t,isPlaying:!0};this.activeSources.add(r),e.onended=()=>{this.activeSources.delete(r)},e.start()}catch(t){console.error(`Failed to play sound: ${e}`,t)}else console.warn(`Audio clip not found: ${e}`)}stopSound(e){this.activeSources.forEach(t=>{t.clip.name===e&&t.isPlaying&&(t.source.stop(),t.isPlaying=!1)})}stopAllSounds(){this.activeSources.forEach(e=>{e.isPlaying&&(e.source.stop(),e.isPlaying=!1)}),this.activeSources.clear()}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(1,e)),this.masterGainNode&&(this.masterGainNode.gain.value=this.masterVolume)}getMasterVolume(){return this.masterVolume}setEnabled(e){this.enabled=e,e?this.bgmName&&this.playBackgroundMusic(this.bgmName):(this.stopAllSounds(),this.stopBackgroundMusic())}isEnabled(){return this.enabled}}class _{constructor(e=0,t=0){this.x=e,this.y=t}static zero(){return new _(0,0)}static one(){return new _(1,1)}static up(){return new _(0,-1)}static down(){return new _(0,1)}static left(){return new _(-1,0)}static right(){return new _(1,0)}clone(){return new _(this.x,this.y)}set(e,t){return this.x=e,this.y=t,this}add(e){return new _(this.x+e.x,this.y+e.y)}subtract(e){return new _(this.x-e.x,this.y-e.y)}multiply(e){return new _(this.x*e,this.y*e)}divide(e){if(0===e)throw new Error("Division by zero");return new _(this.x/e,this.y/e)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalized(){const e=this.magnitude();return 0===e?_.zero():this.divide(e)}distance(e){return this.subtract(e).magnitude()}dot(e){return this.x*e.x+this.y*e.y}static distance(e,t){return new _(e.x,e.y).distance(t)}static lerp(e,t,s){return s=Math.max(0,Math.min(1,s)),new _(e.x+(t.x-e.x)*s,e.y+(t.y-e.y)*s)}static fromAngle(e,t=1){return new _(Math.cos(e)*t,Math.sin(e)*t)}static isVector2(e){return"object"==typeof e&&null!==e&&"number"==typeof e.x&&"number"==typeof e.y}}class I extends O{constructor(){super(...arguments),this.colliders=new Set,this.collisionMap=new Map}addCollider(e){this.colliders.add(e)}removeCollider(e){this.colliders.delete(e),this.collisionMap.delete(e);for(const t of this.collisionMap.values())t.delete(e)}checkCollisions(){var e,t,s,i;const n=Array.from(this.colliders);if(n.length<2)return;const a=new Map;for(let t=0;t<n.length;t++)for(let s=t+1;s<n.length;s++){const i=n[t],o=n[s];if(i!==o&&(!this.collisionMap.has(i)||!(null===(e=this.collisionMap.get(i))||void 0===e?void 0:e.has(o)))&&i.canCollideWith(o)&&this.checkAABBCollision(i.getBounds(),o.getBounds())){const e=this.createCollisionInfo(i,o);i.onCollision(o,e),o.onCollision(i,e),a.has(i)||a.set(i,new Set),a.has(o)||a.set(o,new Set);const t=a.get(i),s=a.get(o);t&&t.add(o),s&&s.add(i)}}for(const[e,n]of this.collisionMap)for(const o of n)(null===(t=a.get(e))||void 0===t?void 0:t.has(o))||(null===(s=e.onCollisionExit)||void 0===s||s.call(e,o),null===(i=o.onCollisionExit)||void 0===i||i.call(o,e));this.collisionMap=a}checkAABBCollision(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}createCollisionInfo(e,t){const s=e.getBounds(),i=t.getBounds();return{point:new _((s.x+s.width/2+i.x+i.width/2)/2,(s.y+s.height/2+i.y+i.height/2)/2),normal:new _(0,-1),penetration:0,colliderA:e,colliderB:t,relativeVelocity:new _(0,0)}}queryAABB(e){return Array.from(this.colliders).filter(t=>this.checkAABBCollision(e,t.getBounds()))}queryPoint(e){return this.queryAABB({x:e.x,y:e.y,width:1,height:1})}raycast(e,t,s=1/0){let i=null,n=1/0;for(const a of this.colliders){const o=a.getBounds(),r=this.raycastAABB(e,t,o,s);r&&r.distance<n&&(n=r.distance,i={collider:a,point:r.point,normal:r.normal,distance:r.distance,gameObject:a.getGameObject()})}return i}raycastAABB(e,t,s,i){const n=1/t.x,a=1/t.y,o=(s.x-e.x)*n,r=(s.x+s.width-e.x)*n,h=(s.y-e.y)*a,l=(s.y+s.height-e.y)*a,c=Math.max(Math.min(o,r),Math.min(h,l)),d=Math.min(Math.max(o,r),Math.max(h,l));if(d<0||c>d||c>i)return null;const u=c>0?c:d;return{point:new _(e.x+t.x*u,e.y+t.y*u),normal:new _(0,-1),distance:u}}clear(){this.colliders.clear()}getColliderCount(){return this.colliders.size}getActiveCollisionCount(){return 0}}class b extends O{constructor(e){super(),this.keyStates=new Map,this.previousKeyStates=new Map,this.mousePosition=_.zero(),this.mouseDelta=_.zero(),this.mouseButtons=new Map,this.previousMouseButtons=new Map,this.touches=new Map,this.enabled=!0,this.canvas=e,this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this)),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("contextmenu",e=>e.preventDefault()),this.canvas.addEventListener("touchstart",this.onTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.onTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.onTouchEnd.bind(this)),this.canvas.addEventListener("touchcancel",this.onTouchCancel.bind(this)),window.addEventListener("blur",()=>{this.clearAllInputs()})}onKeyDown(t){if(!this.enabled)return;t.preventDefault();const s=t.code;this.keyStates.get(s)||this.dispatchEvent("key_down",{inputType:e.KEYBOARD,key:s,isPressed:!0}),this.keyStates.set(s,!0)}onKeyUp(t){if(!this.enabled)return;t.preventDefault();const s=t.code;this.keyStates.set(s,!1),this.dispatchEvent("key_up",{inputType:e.KEYBOARD,key:s,isPressed:!1})}onMouseDown(t){if(!this.enabled)return;t.preventDefault();const s=t.button,i=this.calculateMousePosition(t);this.mouseButtons.set(s,!0),this.dispatchEvent("mouse_down",{inputType:e.MOUSE,button:s,position:i,isPressed:!0})}onMouseUp(t){if(!this.enabled)return;t.preventDefault();const s=t.button,i=this.calculateMousePosition(t);this.mouseButtons.set(s,!1),this.dispatchEvent("mouse_up",{inputType:e.MOUSE,button:s,position:i,isPressed:!1})}onMouseMove(t){if(!this.enabled)return;const s=this.calculateMousePosition(t);this.mouseDelta=s.subtract(this.mousePosition),this.mousePosition=s,this.dispatchEvent("mouse_move",{inputType:e.MOUSE,position:this.mousePosition,delta:this.mouseDelta})}onTouchStart(t){if(this.enabled){t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){const n=t.changedTouches[i],a=this.getTouchPosition(n),o={id:n.identifier,position:a,deltaPosition:_.zero(),startPosition:a.clone(),phase:s.BEGAN,pressure:n.force||1,timestamp:y.totalTime};this.touches.set(n.identifier,o),this.dispatchEvent("touch_start",{inputType:e.TOUCH,touchId:n.identifier,position:a,phase:s.BEGAN})}}}onTouchMove(t){if(this.enabled){t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){const n=t.changedTouches[i],a=this.touches.get(n.identifier);if(!a)continue;const o=this.getTouchPosition(n);a.deltaPosition=o.subtract(a.position),a.position=o,a.phase=s.MOVED,a.timestamp=y.totalTime,this.dispatchEvent("touch_move",{inputType:e.TOUCH,touchId:n.identifier,position:o,delta:a.deltaPosition,phase:s.MOVED})}}}onTouchEnd(t){if(this.enabled){t.preventDefault();for(let i=0;i<t.changedTouches.length;i++){const n=t.changedTouches[i],a=this.touches.get(n.identifier);a&&(a.phase=s.ENDED,a.timestamp=y.totalTime,this.dispatchEvent("touch_end",{inputType:e.TOUCH,touchId:n.identifier,position:a.position,phase:s.ENDED}),this.touches.delete(n.identifier))}}}onTouchCancel(e){if(this.enabled){e.preventDefault();for(let t=0;t<e.changedTouches.length;t++){const s=e.changedTouches[t];this.touches.delete(s.identifier)}}}calculateMousePosition(e){const t=this.canvas.getBoundingClientRect();return new _(e.clientX-t.left,e.clientY-t.top)}getTouchPosition(e){const t=this.canvas.getBoundingClientRect();return new _(e.clientX-t.left,e.clientY-t.top)}isKeyPressed(e){return this.keyStates.get(e)||!1}isKeyJustPressed(e){const t=this.keyStates.get(e)||!1,s=this.previousKeyStates.get(e)||!1;return t&&!s}isKeyJustReleased(e){const t=this.keyStates.get(e)||!1,s=this.previousKeyStates.get(e)||!1;return!t&&s}isMouseButtonPressed(e=t.LEFT){return this.mouseButtons.get(e)||!1}isMouseButtonJustPressed(e=t.LEFT){const s=this.mouseButtons.get(e)||!1,i=this.previousMouseButtons.get(e)||!1;return s&&!i}getMousePosition(){return this.mousePosition.clone()}getMouseDelta(){return this.mouseDelta.clone()}getTouches(){return Array.from(this.touches.values())}getTouchCount(){return this.touches.size}setEnabled(e){this.enabled=e,e||this.clearAllInputs()}isEnabled(){return this.enabled}clearAllInputs(){this.keyStates.clear(),this.mouseButtons.clear(),this.touches.clear(),this.mouseDelta=_.zero()}update(){this.enabled&&(this.previousKeyStates.clear(),this.keyStates.forEach((e,t)=>{this.previousKeyStates.set(t,e)}),this.previousMouseButtons.clear(),this.mouseButtons.forEach((e,t)=>{this.previousMouseButtons.set(t,e)}),this.mouseDelta=_.zero(),this.touches.forEach(e=>{e.phase===s.MOVED&&(e.phase=s.STATIONARY,e.deltaPosition=_.zero())}))}}var C=function(e,t,s,i){return new(s||(s=Promise))(function(n,a){function o(e){try{h(i.next(e))}catch(e){a(e)}}function r(e){try{h(i.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,r)}h((i=i.apply(e,t||[])).next())})};class w extends O{constructor(){super(...arguments),this.resources=new Map,this.loadingPromises=new Map}loadResource(e,t,s){return C(this,void 0,void 0,function*(){const i=this.resources.get(e);if(i){if(i.state===o.LOADED)return i.data;if(i.state===o.LOADING)return this.loadingPromises.get(e);if(i.state===o.ERROR)throw i.error}const n={name:e,url:t,type:s,state:o.LOADING,data:null};this.resources.set(e,n);const a=this.loadResourceByType(n);this.loadingPromises.set(e,a);try{const e=yield a;return n.data=e,n.state=o.LOADED,this.dispatchEvent("resource_loaded",{resource:n}),e}catch(e){throw n.state=o.ERROR,n.error=e,this.dispatchEvent("resource_load_error",{resource:n,error:e}),e}finally{this.loadingPromises.delete(e)}})}loadResourceByType(e){return C(this,void 0,void 0,function*(){const{url:t,type:s}=e;switch(s){case a.IMAGE:return this.loadImage(t);case a.AUDIO:return this.loadAndCheck(t,e=>e.arrayBuffer());case a.TEXT:return this.loadAndCheck(t,e=>e.text());case a.JSON:return this.loadAndCheck(t,e=>e.json());default:throw new Error(`Unsupported resource type: ${s}`)}})}loadAndCheck(e,t){return C(this,void 0,void 0,function*(){const s=yield fetch(e);if(!s.ok)throw new Error(`Failed to load: ${s.status} ${s.statusText}`);return t(s)})}loadImage(e){return C(this,void 0,void 0,function*(){return new Promise((t,s)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>t(i),i.onerror=()=>s(new Error(`Failed to load image: ${e}`)),i.src=e})})}getResource(e){const t=this.resources.get(e);return t&&t.state===o.LOADED?t.data:null}hasResource(e){const t=this.resources.get(e);return void 0!==t&&t.state===o.LOADED}unloadResource(e){this.resources.delete(e)}unloadAll(){this.resources.clear(),this.loadingPromises.clear()}getLoadProgress(){var e;const t=Array.from(this.resources.values()),s=t.length,i=t.filter(e=>e.state===o.LOADED).length;return{totalResources:s,loadedResources:i,failedResources:t.filter(e=>e.state===o.ERROR).length,currentResource:(null===(e=t.find(e=>e.state===o.LOADING))||void 0===e?void 0:e.name)||"",percentage:s>0?i/s*100:100}}}class M extends O{constructor(e){super(),this.enabled=!0,this.destroyed=!1,this.started=!1,this.awoken=!1,this.gameObject=e}getGameObject(){return this.gameObject}getType(){return this.constructor.name}setEnabled(e){const t=this.enabled;this.enabled=e,e&&!t?this.onEnable():!e&&t&&this.onDisable()}isEnabled(){return this.enabled&&this.gameObject.isActive()&&!this.destroyed}setVisible(e){this.setEnabled(e)}isVisible(){return this.isEnabled()}awake(){this.awoken||(this.onAwake(),this.awoken=!0)}start(){this.started||(this.onStart(),this.started=!0)}onAwake(){}onStart(){}onEnable(){}onDisable(){}onDestroy(){this.destroyed=!0,this.removeAllEventListeners()}serialize(){return{type:this.getType(),enabled:this.enabled}}deserialize(e){this.enabled="boolean"!=typeof e.enabled||e.enabled}}class P extends M{constructor(e,t=_.zero()){super(e),this.parent=null,this.children=[],this.needsUpdate=!0,this.position=new _(t.x,t.y),this.rotation=0,this.scale=_.one(),this.worldPosition=this.position.clone(),this.worldRotation=0,this.worldScale=_.one()}translate(e){this.position=this.position.add(e),this.markNeedsUpdate()}rotate(e){this.rotation+=e,this.markNeedsUpdate()}setPosition(e){this.position=new _(e.x,e.y),this.markNeedsUpdate()}setRotation(e){this.rotation=e,this.markNeedsUpdate()}setScale(e){this.scale=new _(e.x,e.y),this.markNeedsUpdate()}getWorldPosition(){return this.updateWorldTransform(),this.worldPosition.clone()}getWorldRotation(){return this.updateWorldTransform(),this.worldRotation}getWorldScale(){return this.updateWorldTransform(),this.worldScale.clone()}setParent(e){if(this.parent!==e){if(this.parent){const e=this.parent.children.indexOf(this);-1!==e&&this.parent.children.splice(e,1)}this.parent=e,e&&e.children.push(this),this.markNeedsUpdate()}}getParent(){return this.parent}getChildren(){return[...this.children]}updateWorldTransform(){this.needsUpdate&&(this.parent?(this.parent.updateWorldTransform(),this.worldPosition=this.parent.worldPosition.add(this.position),this.worldRotation=this.parent.worldRotation+this.rotation,this.worldScale=new _(this.parent.worldScale.x*this.scale.x,this.parent.worldScale.y*this.scale.y)):(this.worldPosition=this.position.clone(),this.worldRotation=this.rotation,this.worldScale=this.scale.clone()),this.needsUpdate=!1,this.children.forEach(e=>e.markNeedsUpdate()))}markNeedsUpdate(){this.needsUpdate=!0,this.children.forEach(e=>e.markNeedsUpdate())}update(e){}render(e){}serialize(){return Object.assign(Object.assign({},super.serialize()),{position:{x:this.position.x,y:this.position.y},rotation:this.rotation,scale:{x:this.scale.x,y:this.scale.y}})}deserialize(e){super.deserialize(e),_.isVector2(e.position)&&(this.position=new _(e.position.x,e.position.y)),this.rotation="number"==typeof e.rotation?e.rotation:0,_.isVector2(e.scale)&&(this.scale=new _(e.scale.x,e.scale.y)),this.markNeedsUpdate()}}class v extends O{constructor(e={}){super(),this.components=new Map,this.destroyed=!1,this.active=!0,this.visible=!0,this.started=!1,this.awaken=!1,this.id=this.generateId(),this.name=e.name||`GameObject_${this.id}`,this.tag=e.tag||"Untagged",this.layer=e.layer||0,this.active=!1!==e.active;const t=e.position?new _(e.position.x,e.position.y):_.zero();if(this.addComponent(new P(this,t)),e.rotation||e.scale){const t=this.getTransform();e.rotation&&t.setRotation(e.rotation),e.scale&&t.setScale(e.scale)}}generateId(){return Math.random().toString(36).substr(2,9)+Date.now().toString(36)}addComponent(e){const t=e.getType();return this.components.has(t)&&this.removeComponent(e.constructor),this.components.set(t,e),this.awaken&&e.awake(),this.started&&e.start(),this.dispatchEvent("component_added",{component:e}),e}getComponent(e){const t=e.name;return this.components.get(t)||null}removeComponent(e){const t=e.name,s=this.components.get(t);s&&(s.onDestroy(),this.components.delete(t),this.dispatchEvent("component_removed",{component:s}))}hasComponent(e){const t=e.name;return this.components.has(t)}getAllComponents(){return Array.from(this.components.values())}getTransform(){const e=this.getComponent(P);if(!e)throw new Error("Transform component not found on GameObject.");return e}awake(){this.awaken||(this.components.forEach(e=>e.awake()),this.onAwake(),this.awaken=!0)}start(){this.started||(this.components.forEach(e=>e.start()),this.onStart(),this.started=!0)}onAwake(){}onStart(){}onEnable(){this.components.forEach(e=>e.onEnable())}onDisable(){this.components.forEach(e=>e.onDisable())}setActive(e){const t=this.active;this.active=e,e&&!t?(this.onEnable(),this.dispatchEvent("game_object_activated")):!e&&t&&(this.onDisable(),this.dispatchEvent("game_object_deactivated"))}isActive(){return this.active&&!this.destroyed}setEnabled(e){this.setActive(e)}isEnabled(){return this.isActive()}setVisible(e){this.visible=e}isVisible(){return this.visible}getPosition(){return this.getTransform().getWorldPosition()}setPosition(e){this.getTransform().setPosition(e)}getRotation(){return this.getTransform().getWorldRotation()}setRotation(e){this.getTransform().setRotation(e)}translate(e){this.getTransform().translate(e)}rotate(e){this.getTransform().rotate(e)}update(e){this.isActive()&&(this.components.forEach(t=>{t.isEnabled()&&t.update(e)}),this.onUpdate(e))}render(e){this.isActive()&&(this.components.forEach(t=>{t.isVisible()&&t.render(e)}),this.onRender(e))}onUpdate(e){}onRender(e){}destroy(){this.destroyed||(this.destroyed=!0,this.components.forEach(e=>e.onDestroy()),this.components.clear(),this.onDestroy(),this.removeAllEventListeners(),this.dispatchEvent("game_object_destroyed"))}destroyComponent(e){const t=e.name,s=this.components.get(t);s&&(s.onDestroy(),this.components.delete(t))}isDestroyed(){return this.destroyed}onDestroy(){}serialize(){const e={};return this.components.forEach((t,s)=>{e[s]=t.serialize()}),{id:this.id,name:this.name,tag:this.tag,layer:this.layer,active:this.active,components:e}}deserialize(e){"string"==typeof e.name&&(this.name=e.name),"string"==typeof e.tag&&(this.tag=e.tag),"number"==typeof e.layer&&(this.layer=e.layer),this.active=!1!==e.active,e.components&&"object"==typeof e.components&&null!==e.components&&this.components.forEach((t,s)=>{Object.prototype.hasOwnProperty.call(e.components,s)&&e.components[s]&&t.deserialize(e.components[s])})}static createEmpty(e){return new v({name:e})}static createWithTransform(e,t,s){return new v({position:e,rotation:t,scale:s})}}const R={PLAYER:{JUMP_FORCE:-800,MOVE_SPEED:600,MAX_FALL_SPEED:2200},DECORATION:{WIDTH:64,HEIGHT:120},PLATFORM:{WIDTH:196,HEIGHT:64,SPAWN_DISTANCE:96,MAX_SPAWN_DISTANCE:400,INITIAL_COUNT:10},OBSTACLES:{LANDED_SPIKE:{ICON:"landed_spike",SPAWN_CHANCE:.1,WIDTH:96,HEIGHT:24,SPAWN_LEVEL:1},FLYING_MONSTER:{ICON:"flying_monster",SPAWN_CHANCE:.1,WIDTH:96,HEIGHT:96,MOVE_SPEED:400,SPAWN_LEVEL:1},WITCH:{ICON:"witch",SPAWN_CHANCE:.1,WIDTH:128,HEIGHT:128,MOVE_SPEED:200,MOVE_RANGE:400,SPAWN_LEVEL:3}},ITEMS:{TRAMPOLINE:{ICON:"trampoline",SPAWN_CHANCE:.5,WIDTH:64,HEIGHT:64,BOUNCE_FORCE:1200},JETPACK:{ICON:"jetpack",SPAWN_CHANCE:.5,WIDTH:64,HEIGHT:64,FUEL:25,FUEL_CONSUMPTION_RATE:10}},BACKGROUND:{CLOUD:{WIDTH:200,HEIGHT:100,MOVE_SPEED:50,COUNT:5}},IMAGES:{BACKGROUND:{GAMEPLAY_BACKGROUND:"gameplay_background",MAINMENU_BACKGROUND:"main_menu_background",PAUSE_PANEL_BACKGROUND:"pause_panel_background"},BUTTON:{PLAY_BUTTON:"play_button",RESUME_BUTTON:"resume_button",SETTINGS_BUTTON:"settings_button",BACK_BUTTON:"back_button",RESTART_BUTTON:"restart_button",SOUND_ON_BUTTON:"sound_on_button",SOUND_OFF_BUTTON:"sound_off_button"},CLOUD:"cloud",PLATFORMS:{PLATFORM_1:"platform_1",PLATFORM_2:"platform_2",PLATFORM_3:"platform_3",PLATFORM_4:"platform_4",PLATFORM_5:"platform_5"},DECORATIONS:{TREE_1:"tree_1",TREE_2:"tree_2",TREE_3:"tree_3",TREE_4:"tree_4",LAMP_POST_1:"lamp_post_1",LAMP_POST_2:"lamp_post_2"},BREAKABLE_PLATFORM:"breakable_platform",BROKEN_PLATFORM:"broken_platform",GROUND:"ground",PLAYERS:{PLAYER_IDLE:"player_idle",PLAYER_MOVE_LEFT:"player_move_left",PLAYER_MOVE_RIGHT:"player_move_right",PLAYER_JUMP:"player_jump",PLAYER_IDLE_JETPACK:"player_idle_jetpack",PLAYER_MOVE_LEFT_JETPACK:"player_move_left_jetpack",PLAYER_MOVE_RIGHT_JETPACK:"player_move_right_jetpack",PLAYER_DEAD:"player_dead"},PROJECTILE:"projectile"},AUDIO:{SFX:{TRAMPOLINE:"trampoline",JUMP:"jump",JETPACK:"jetpack",HIT:"hit",WALK:"walk",BUTTON_CLICK:"button_click",SHOOT:"shoot",PLATFORM_BREAK:"platform_break",DESTROY_OBSTACLE:"destroy_obstacle"},MUSIC:{BACKGROUND_MUSIC:"background_music"}},ANIMATIONS:{PLAYER_IDLE:{Name:"player_idle",Frames:["player_idle_1","player_idle_2","player_idle_3","player_idle_4","player_idle_5","player_idle_6"],FrameRate:500,Loop:!0},PLAYER_IDLE_JETPACK:{Name:"player_idle_jetpack",Frames:["player_idle_jetpack_1","player_idle_jetpack_2","player_idle_jetpack_3","player_idle_jetpack_4","player_idle_jetpack_5","player_idle_jetpack_6"],FrameRate:500,Loop:!0},PLAYER_MOVE_LEFT:{Name:"player_move_left",Frames:["player_move_left_1","player_move_left_2","player_move_left_3","player_move_left_4"],FrameRate:300,Loop:!0},PLAYER_MOVE_LEFT_JETPACK:{Name:"player_move_left_jetpack",Frames:["player_move_left_jetpack_1","player_move_left_jetpack_2","player_move_left_jetpack_3","player_move_left_jetpack_4"],FrameRate:300,Loop:!0},PLAYER_MOVE_RIGHT:{Name:"player_move_right",Frames:["player_move_right_1","player_move_right_2","player_move_right_3","player_move_right_4"],FrameRate:300,Loop:!0},PLAYER_MOVE_RIGHT_JETPACK:{Name:"player_move_right_jetpack",Frames:["player_move_right_jetpack_1","player_move_right_jetpack_2","player_move_right_jetpack_3","player_move_right_jetpack_4"],FrameRate:300,Loop:!0},PLAYER_JUMP:{Name:"player_jump",Frames:["player_jump_1","player_jump_2","player_jump_3"],FrameRate:300,Loop:!1},PLAYER_DEAD:{Name:"player_dead",Frames:["player_dead","player_dead","player_dead"],FrameRate:300,Loop:!1},PROJECTILE:{Name:"projectile",Frames:["projectile_1","projectile_2","projectile_3","projectile_4"],FrameRate:15,Loop:!0}},DIFFICULTY:500,HIGH_SCORE_KEY:"doodleJump_highScore",CURRENT_SCORE_KEY:"doodleJump_currentScore",AUDIO_ENABLED_KEY:"doodleJump_audioEnabled",SETTING_KEY:"doodleJump_settings",MOVING_PLATFORM_SPAWN_CHANCE:.2,BREAKABLE_PLATFORM_SPAWN_CHANCE:.1};class L{static clamp(e,t,s){return Math.max(t,Math.min(s,e))}static clamp01(e){return this.clamp(e,0,1)}static lerp(e,t,s){return e+(t-e)*this.clamp01(s)}static lerpUnclamped(e,t,s){return e+(t-e)*s}static inverseLerp(e,t,s){return e!==t?this.clamp01((s-e)/(t-e)):0}static smoothStep(e,t,s){return s=(s=this.clamp01(s))*s*(3-2*s),this.lerp(e,t,s)}static pingPong(e,t){return e%=2*t,t-Math.abs(e-t)}static repeat(e,t){return e-Math.floor(e/t)*t}static sign(e){return e>=0?1:-1}static distance(e,t,s,i){const n=s-e,a=i-t;return Math.sqrt(n*n+a*a)}static sqrDistance(e,t,s,i){const n=s-e,a=i-t;return n*n+a*a}static random(e,t){if(void 0===e&&void 0===t)return Math.random();if(void 0===t)return Math.random()*(null!=e?e:1);{const s=null!=e?e:0;return Math.random()*(t-s)+s}}static randomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static randomSign(){return Math.random()<.5?-1:1}static randomBool(){return Math.random()<.5}static randomChoice(e){return e[this.randomInt(0,e.length-1)]}static shuffle(e){const t=[...e];for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}static degToRad(e){return e*this.DEG_TO_RAD}static radToDeg(e){return e*this.RAD_TO_DEG}static isPowerOfTwo(e){return!(e&e-1)&&0!==e}static nextPowerOfTwo(e){return Math.pow(2,Math.ceil(Math.log2(e)))}static map(e,t,s,i,n){return i+(e-t)/(s-t)*(n-i)}static approximately(e,t,s=1e-4){return Math.abs(e-t)<s}}L.PI=Math.PI,L.TWO_PI=2*Math.PI,L.HALF_PI=.5*Math.PI,L.DEG_TO_RAD=Math.PI/180,L.RAD_TO_DEG=180/Math.PI;class D{constructor(e=255,t=255,s=255,i=1){this.r=L.clamp(e,0,255),this.g=L.clamp(t,0,255),this.b=L.clamp(s,0,255),this.a=L.clamp(i,0,1)}clone(){return new D(this.r,this.g,this.b,this.a)}set(e,t=1){return this.r=L.clamp(e.r,0,255),this.g=L.clamp(e.g,0,255),this.b=L.clamp(e.b,0,255),this.a=L.clamp(t,0,1),this}toString(){return`rgba(${Math.round(this.r)}, ${Math.round(this.g)}, ${Math.round(this.b)}, ${this.a})`}toHex(){const e=e=>{const t=Math.round(e).toString(16);return 1===t.length?"0"+t:t};return`#${e(this.r)}${e(this.g)}${e(this.b)}`}toHSL(){const e=this.r/255,t=this.g/255,s=this.b/255,i=Math.max(e,t,s),n=Math.min(e,t,s);let a,o;const r=(i+n)/2;if(i===n)a=o=0;else{const h=i-n;switch(o=r>.5?h/(2-i-n):h/(i+n),i){case e:a=(t-s)/h+(t<s?6:0);break;case t:a=(s-e)/h+2;break;case s:a=(e-t)/h+4;break;default:a=0}a/=6}return{h:360*a,s:100*o,l:100*r}}lerp(e,t){return t=L.clamp01(t),new D(L.lerp(this.r,e.r,t),L.lerp(this.g,e.g,t),L.lerp(this.b,e.b,t),L.lerp(this.a,e.a,t))}multiply(e){return new D(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255,this.a*e.a)}add(e){return new D(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}static fromHex(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?new D(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):new D}static fromHSL(e,t=1){e.h=e.h/360,e.s=e.s/100,e.l=e.l/100;const s=(e,t,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e);let i,n,a;if(0===e.s)i=n=a=e.l;else{const t=e.l<.5?e.l*(1+e.s):e.l+e.s-e.l*e.s,o=2*e.l-t;i=s(o,t,e.h+1/3),n=s(o,t,e.h),a=s(o,t,e.h-1/3)}return new D(255*i,255*n,255*a,t)}static lerp(e,t,s){return e.lerp(t,s)}static isRGBAColor(e){return"object"==typeof e&&null!==e&&"number"==typeof e.r&&"number"==typeof e.g&&"number"==typeof e.b&&"number"==typeof e.a}}D.WHITE=new D(255,255,255),D.BLACK=new D(0,0,0),D.RED=new D(255,0,0),D.GREEN=new D(0,255,0),D.BLUE=new D(0,0,255),D.YELLOW=new D(255,255,0),D.CYAN=new D(0,255,255),D.MAGENTA=new D(255,0,255),D.ORANGE=new D(255,165,0),D.PURPLE=new D(128,0,128),D.PINK=new D(255,192,203),D.BROWN=new D(165,42,42),D.GRAY=new D(128,128,128),D.LIGHT_GRAY=new D(211,211,211),D.DARK_GRAY=new D(64,64,64),D.TRANSPARENT=new D(0,0,0,0),D.AQUA=new D(0,255,255),D.LIME=new D(0,255,0),D.NAVY=new D(0,0,128),D.TEAL=new D(0,128,128),D.OLIVE=new D(128,128,0),D.SILVER=new D(192,192,192),D.GOLD=new D(255,215,0),D.INDIGO=new D(75,0,130),D.VIOLET=new D(238,130,238),D.MAROON=new D(128,0,0),D.CORAL=new D(255,127,80),D.SALMON=new D(250,128,114),D.SKY_BLUE=new D(135,206,235),D.GOLDENROD=new D(218,165,32),D.DARK_RED=new D(139,0,0),D.DARK_GREEN=new D(0,100,0),D.DARK_BLUE=new D(0,0,139),D.DARK_ORANGE=new D(255,140,0),D.DARK_CYAN=new D(0,139,139),D.DARK_MAGENTA=new D(139,0,139),D.DARK_YELLOW=new D(128,128,0),D.LIGHT_BLUE=new D(173,216,230),D.LIGHT_GREEN=new D(144,238,144),D.LIGHT_PINK=new D(255,182,193),D.LIGHT_YELLOW=new D(255,255,224),D.LIGHT_ORANGE=new D(255,228,181),D.LIGHT_PURPLE=new D(221,160,221),D.LIGHT_BROWN=new D(210,180,140);class N extends M{constructor(e){super(e),this.anchor=d.TOP_LEFT,this.pivot=_.zero(),this.size=new _(100,50),this.margin={top:0,right:0,bottom:0,left:0},this.padding={top:5,right:5,bottom:5,left:5},this.parent=null,this.children=[],this.canvas=null,this.canvasSize=_.zero()}setCanvas(e){this.canvas=e,this.canvasSize=new _(e.width,e.height)}addChild(e){if(!(e instanceof N))throw new Error("Child must be an instance of UIElement");e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),this.canvas&&e.setCanvas(this.canvas)}removeChild(e){if(!(e instanceof N))throw new Error("Child must be an instance of UIElement");const t=this.children.indexOf(e);-1!==t&&(e.parent=null,this.children.splice(t,1))}getParent(){return this.parent}getChildren(){if(0===this.children.length)return[];const e=[];return this.children.forEach(t=>{e.push(t)}),e}setLocalPosition(e){const t=this.gameObject.getComponent(P);t&&t.setPosition(e)}setAnchor(e){this.anchor=e}setPivot(e){this.pivot=new _(e.x,e.y)}getWorldBounds(){const e=this.getWorldPosition(),t=new _(this.size.x*this.pivot.x,this.size.y*this.pivot.y);return{x:e.x-t.x,y:e.y-t.y,width:this.size.x,height:this.size.y}}getWorldPosition(){let e=_.zero();if(this.parent){const t=this.parent.getWorldBounds(),s=this.getAnchorPosition(this.anchor,t),i=this.gameObject.getComponent(P),n=i?i.position:_.zero();e=s.add(n)}else if(this.canvas){const t=this.getAnchorPosition(this.anchor,{x:0,y:0,width:this.canvas.width,height:this.canvas.height}),s=this.gameObject.getComponent(P),i=s?s.position:_.zero();e=t.add(i)}return e}getAnchorPosition(e,t){switch(e){case d.TOP_LEFT:return new _(t.x,t.y);case d.TOP_CENTER:return new _(t.x+t.width/2,t.y);case d.TOP_RIGHT:return new _(t.x+t.width,t.y);case d.MIDDLE_LEFT:return new _(t.x,t.y+t.height/2);case d.MIDDLE_CENTER:return new _(t.x+t.width/2,t.y+t.height/2);case d.MIDDLE_RIGHT:return new _(t.x+t.width,t.y+t.height/2);case d.BOTTOM_LEFT:return new _(t.x,t.y+t.height);case d.BOTTOM_CENTER:return new _(t.x+t.width/2,t.y+t.height);case d.BOTTOM_RIGHT:return new _(t.x+t.width,t.y+t.height);default:return new _(t.x,t.y)}}update(e){this.children.forEach(t=>{t.isEnabled()&&t.update(e)})}render(e){this.isVisible()&&(this.onRender(e),this.children.forEach(t=>{t.isVisible()&&t.render(e)}))}onRender(e){}serialize(){return Object.assign(Object.assign({},super.serialize()),{anchor:this.anchor,pivot:this.pivot,size:this.size,margin:this.margin,padding:this.padding})}deserialize(e){super.deserialize(e),this.anchor=e.anchor||d.TOP_LEFT,_.isVector2(e.pivot)&&(this.pivot=new _(e.pivot.x,e.pivot.y)),_.isVector2(e.size)&&(this.size=new _(e.size.x,e.size.y))}}class G extends N{constructor(e,t=""){super(e),this.text="",this.font="16px Arial",this.color=D.WHITE,this.textAlign="left",this.textBaseline="top",this.wordWrap=!1,this.lineHeight=1.2,this.text=t}setText(e){this.text=e}setFont(e){this.font=e}setColor(e){this.color=e}setTextAlign(e){this.textAlign=e}setTextBaseline(e){this.textBaseline=e}onRender(e){if(!this.text)return;const t=this.getWorldBounds();if(e.save(),e.font=this.font,e.fillStyle=new D(this.color.r,this.color.g,this.color.b,this.color.a).toString(),e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,this.wordWrap)this.renderWrappedText(e,t);else{const s=this.getTextX(t),i=this.getTextY(t);e.fillText(this.text,s,i)}e.restore()}renderWrappedText(e,t){const s=this.text.split(" "),i=[];let n="";for(const a of s){const s=n+(n?" ":"")+a;e.measureText(s).width>t.width-this.padding.left-this.padding.right&&n?(i.push(n),n=a):n=s}n&&i.push(n);const a=parseInt(this.font)*this.lineHeight;let o=t.y+this.padding.top;"middle"===this.textBaseline?o=t.y+t.height/2-i.length*a/2:"bottom"===this.textBaseline&&(o=t.y+t.height-this.padding.bottom-i.length*a),i.forEach((s,i)=>{const n=this.getTextX(t),r=o+i*a;e.fillText(s,n,r)})}getTextX(e){switch(this.textAlign){case"left":default:return e.x+this.padding.left;case"center":return e.x+e.width;case"right":return e.x+e.width-this.padding.right}}getTextY(e){switch(this.textBaseline){case"top":default:return e.y+this.padding.top;case"middle":return e.y+e.height/2+this.padding.top-this.padding.bottom+8;case"bottom":return e.y+e.height-this.padding.bottom}}serialize(){return Object.assign(Object.assign({},super.serialize()),{text:this.text,font:this.font,color:this.color,textAlign:this.textAlign,textBaseline:this.textBaseline,wordWrap:this.wordWrap,lineHeight:this.lineHeight})}deserialize(e){super.deserialize(e),"string"==typeof e.text&&(this.text=e.text),"string"==typeof e.font&&(this.font=e.font),D.isRGBAColor(e.color)&&(this.color=e.color),"string"==typeof e.textAlign&&(this.textAlign=e.textAlign),"string"==typeof e.textBaseline&&(this.textBaseline=e.textBaseline),"boolean"==typeof e.wordWrap&&(this.wordWrap=e.wordWrap),"number"==typeof e.lineHeight&&(this.lineHeight=e.lineHeight)}}class B extends N{constructor(e){super(e),this.backgroundColor=D.DARK_GRAY,this.borderColor=D.GRAY,this.borderWidth=1,this.cornerRadius=5,this.alpha=1}setBackgroundColor(e){this.backgroundColor=e}setBorderColor(e){this.borderColor=e}setBorderWidth(e){this.borderWidth=e}setCornerRadius(e){this.cornerRadius=e}onRender(e){const t=this.getWorldBounds();e.save(),e.globalAlpha=this.alpha,this.cornerRadius>0?(this.drawRoundedRect(e,t,this.cornerRadius),e.fillStyle=new D(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a).toString(),e.fill()):(e.fillStyle=new D(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a).toString(),e.fillRect(t.x,t.y,t.width,t.height)),this.borderWidth>0&&(this.cornerRadius>0?this.drawRoundedRect(e,t,this.cornerRadius):e.rect(t.x,t.y,t.width,t.height),e.strokeStyle=new D(this.borderColor.r,this.borderColor.g,this.borderColor.b,this.borderColor.a).toString(),e.lineWidth=this.borderWidth,e.stroke()),e.restore()}drawRoundedRect(e,t,s){e.beginPath(),e.moveTo(t.x+s,t.y),e.lineTo(t.x+t.width-s,t.y),e.quadraticCurveTo(t.x+t.width,t.y,t.x+t.width,t.y+s),e.lineTo(t.x+t.width,t.y+t.height-s),e.quadraticCurveTo(t.x+t.width,t.y+t.height,t.x+t.width-s,t.y+t.height),e.lineTo(t.x+s,t.y+t.height),e.quadraticCurveTo(t.x,t.y+t.height,t.x,t.y+t.height-s),e.lineTo(t.x,t.y+s),e.quadraticCurveTo(t.x,t.y,t.x+s,t.y),e.closePath()}serialize(){return Object.assign(Object.assign({},super.serialize()),{backgroundColor:this.backgroundColor,borderColor:this.borderColor,borderWidth:this.borderWidth,cornerRadius:this.cornerRadius,alpha:this.alpha})}deserialize(e){super.deserialize(e),D.isRGBAColor(e.backgroundColor)&&(this.backgroundColor=e.backgroundColor),D.isRGBAColor(e.borderColor)&&(this.borderColor=e.borderColor),"number"==typeof e.borderWidth&&(this.borderWidth=e.borderWidth),"number"==typeof e.cornerRadius&&(this.cornerRadius=e.cornerRadius),"number"==typeof e.alpha&&(this.alpha=e.alpha)}}class x extends B{constructor(e,t="Button"){super(e),this.label=null,this.state=u.NORMAL,this.normalColor=D.GRAY,this.hoverColor=D.LIGHT_GRAY,this.pressedColor=D.DARK_GRAY,this.disabledColor=new D(64,64,64,128),this.normalTextColor=D.WHITE,this.hoverTextColor=D.WHITE,this.pressedTextColor=D.LIGHT_GRAY,this.disabledTextColor=D.DARK_GRAY,this.onClick=null,this.onHover=null,this.onPress=null,this.onRelease=null,this.isMouseOver=!1,this.isMouseDown=!1;const s=new v({name:"ButtonLabel",position:new _(0,0)}),i=new G(s,t);i.textAlign="center",i.textBaseline="middle",this.label=i,this.anchor=d.MIDDLE_CENTER,this.addChild(this.label),this.updateAppearance()}setText(e){this.label&&this.label.setText(e)}setOnClick(e){this.onClick=e}setOnHover(e){this.onHover=e}setOnPress(e){this.onPress=e}setOnRelease(e){this.onRelease=e}setColors(e,t,s){this.normalColor=e,this.normalTextColor=t,this.hoverColor=s,this.updateAppearance()}setEnabled(e){super.setEnabled(e),this.state=e?u.NORMAL:u.DISABLED,this.updateAppearance()}handleMouseMove(e){var t;if(!this.isEnabled())return;const s=this.getWorldBounds(),i=this.isMouseOver;this.isMouseOver=e.x>=s.x&&e.x<=s.x+s.width&&e.y>=s.y&&e.y<=s.y+s.height,this.isMouseOver&&!i?(this.state=this.isMouseDown?u.PRESSED:u.HOVERED,null===(t=this.onHover)||void 0===t||t.call(this)):!this.isMouseOver&&i&&(this.state=u.NORMAL),this.updateAppearance()}handleMouseDown(e){var t;this.isEnabled()&&this.isMouseOver&&(this.isMouseDown=!0,this.state=u.PRESSED,null===(t=this.onPress)||void 0===t||t.call(this),this.updateAppearance(),H.getInstance().getAudioManager().playSound(R.AUDIO.SFX.BUTTON_CLICK))}handleMouseUp(e){var t,s;if(!this.isEnabled())return;const i=this.isMouseDown;this.isMouseDown=!1,i&&this.isMouseOver&&(null===(t=this.onClick)||void 0===t||t.call(this)),this.state=this.isMouseOver?u.HOVERED:u.NORMAL,null===(s=this.onRelease)||void 0===s||s.call(this),this.updateAppearance()}handleTouchStart(e){var t;if(!this.isEnabled())return;const s=this.getWorldBounds();e.x>=s.x&&e.x<=s.x+s.width&&e.y>=s.y&&e.y<=s.y+s.height&&(this.isMouseOver=!0,this.isMouseDown=!0,this.state=u.PRESSED,null===(t=this.onPress)||void 0===t||t.call(this),this.updateAppearance(),H.getInstance().getAudioManager().playSound(R.AUDIO.SFX.BUTTON_CLICK))}handleTouchEnd(e){var t,s;if(!this.isEnabled())return;const i=this.getWorldBounds(),n=e.x>=i.x&&e.x<=i.x+i.width&&e.y>=i.y&&e.y<=i.y+i.height,a=this.isMouseDown;this.isMouseDown=!1,a&&n&&(null===(t=this.onClick)||void 0===t||t.call(this)),this.state=n?u.HOVERED:u.NORMAL,null===(s=this.onRelease)||void 0===s||s.call(this),this.updateAppearance()}updateAppearance(){switch(this.state){case u.NORMAL:this.backgroundColor=this.normalColor,this.label&&(this.label.color=this.normalTextColor);break;case u.HOVERED:this.backgroundColor=this.hoverColor,this.label&&(this.label.color=this.hoverTextColor);break;case u.PRESSED:this.backgroundColor=this.pressedColor,this.label&&(this.label.color=this.pressedTextColor);break;case u.DISABLED:this.backgroundColor=this.disabledColor,this.label&&(this.label.color=this.disabledTextColor)}}serialize(){return Object.assign(Object.assign({},super.serialize()),{state:this.state,normalColor:this.normalColor,hoverColor:this.hoverColor,pressedColor:this.pressedColor,disabledColor:this.disabledColor,normalTextColor:this.normalTextColor,hoverTextColor:this.hoverTextColor,pressedTextColor:this.pressedTextColor,disabledTextColor:this.disabledTextColor})}deserialize(e){super.deserialize(e),"string"==typeof e.state&&(this.state=e.state),D.isRGBAColor(e.normalColor)&&(this.normalColor=e.normalColor),D.isRGBAColor(e.hoverColor)&&(this.hoverColor=e.hoverColor),this.updateAppearance()}}class k extends O{constructor(e){super(),this.rootElements=[],this.canvas=e,this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this))}addRootElement(e){e.setCanvas(this.canvas),this.rootElements.push(e)}removeRootElement(e){const t=this.rootElements.indexOf(e);-1!==t&&this.rootElements.splice(t,1)}update(e){this.rootElements.forEach(t=>{t.isEnabled()&&t.update(e)})}render(e){this.rootElements.forEach(t=>{t.isVisible()&&t.render(e)})}handleMouseMove(e){const t=this.canvas.getBoundingClientRect(),s=new _(e.clientX-t.left,e.clientY-t.top);this.processUIElements(this.rootElements,e=>{e instanceof x&&e.handleMouseMove(s)})}handleMouseDown(e){const t=this.canvas.getBoundingClientRect(),s=new _(e.clientX-t.left,e.clientY-t.top);this.processUIElements(this.rootElements,e=>{e instanceof x&&e.handleMouseDown(s)})}handleMouseUp(e){const t=this.canvas.getBoundingClientRect(),s=new _(e.clientX-t.left,e.clientY-t.top);this.processUIElements(this.rootElements,e=>{e instanceof x&&e.handleMouseUp(s)})}getPointerPosition(e,t){const s=this.canvas.getBoundingClientRect(),i=this.canvas.width/s.width,n=this.canvas.height/s.height;return new _((e-s.left)*i,(t-s.top)*n)}handleTouchStart(e){for(let t=0;t<e.changedTouches.length;t++){const s=e.changedTouches[t],i=this.getPointerPosition(s.clientX,s.clientY);this.processUIElements(this.rootElements,e=>{e instanceof x&&e.handleTouchStart(i)})}}handleTouchEnd(e){for(let t=0;t<e.changedTouches.length;t++){const s=e.changedTouches[t],i=this.getPointerPosition(s.clientX,s.clientY);this.processUIElements(this.rootElements,e=>{e instanceof x&&e.handleTouchEnd(i)})}}processUIElements(e,t){e.forEach(e=>{t(e),this.processUIElements(e.getChildren(),t)})}}class H extends O{constructor(e){if(super(),this.scenes=new Map,this.currentScene=null,this.isRunning=!1,this.isPaused=!1,this.lastTime=0,this.targetFPS=60,this.frameTime=1e3/this.targetFPS,this.frameCount=0,this.fpsCounter=0,this.lastFpsUpdate=0,this.canvas=document.getElementById(e.canvasId),!this.canvas)throw new Error(`Canvas with id '${e.canvasId}' not found`);const t=this.canvas.getContext("2d");if(!t)throw new Error("Could not get 2D context from canvas");this.ctx=t,this.setupCanvas(e.width||800,e.height||600),this.initializeSystems(),e.targetFPS&&this.setTargetFPS(e.targetFPS),H.instance||(H.instance=this),this.dispatchEvent("engine_initialized")}static getInstance(){if(!H.instance)throw new Error("GameEngine has not been initialized. Please create an instance first.");return H.instance}setupCanvas(e,t){this.canvas.width=e,this.canvas.height=t,this.canvas.addEventListener("contextmenu",e=>e.preventDefault()),this.canvas.tabIndex=1e3,this.canvas.style.display="block",this.canvas.style.margin="auto",this.canvas.style.border="1px solid #333",document.body.style.display="flex",document.body.style.justifyContent="center",document.body.style.alignItems="center",document.body.style.margin="0"}initializeSystems(){this.inputManager=new b(this.canvas),this.audioManager=new S,this.resourceManager=new w,this.collisionManager=new I,this.uiManager=new k(this.canvas)}addScene(e,t){this.scenes.set(e,t),this.dispatchEvent("scene_added",{name:e,scene:t})}setScene(e){return t=this,s=void 0,n=function*(){const t=this.scenes.get(e);if(!t)throw new Error(`Scene '${e}' not found`);this.currentScene&&(yield this.currentScene.unload(),this.collisionManager.clear()),this.currentScene=t,yield this.currentScene.load(),this.dispatchEvent("scene_changed",{name:e,scene:t})},new((i=void 0)||(i=Promise))(function(e,a){function o(e){try{h(n.next(e))}catch(e){a(e)}}function r(e){try{h(n.throw(e))}catch(e){a(e)}}function h(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i(function(e){e(s)})).then(o,r)}h((n=n.apply(t,s||[])).next())});var t,s,i,n}getCurrentScene(){return this.currentScene}start(){this.isRunning||(this.isRunning=!0,this.isPaused=!1,this.lastTime=performance.now(),y.reset(),this.gameLoop(this.lastTime),this.dispatchEvent("engine_started"))}stop(){this.isRunning=!1,this.dispatchEvent("engine_stopped")}pause(){this.isPaused=!0,this.dispatchEvent("engine_paused")}resume(){this.isPaused=!1,this.lastTime=performance.now(),this.dispatchEvent("engine_resumed")}gameLoop(e){if(!this.isRunning)return;let t=e-this.lastTime;this.lastTime=e,t=Math.min(t,2*this.frameTime),y.update(t),this.isPaused||(this.update(t),this.render()),this.updatePerformanceStats(),requestAnimationFrame(e=>this.gameLoop(e))}update(e){this.inputManager.update(),this.currentScene&&this.currentScene.update(e),this.collisionManager.checkCollisions(),this.dispatchEvent("engine_updated",{deltaTime:e})}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentScene&&this.currentScene.render(this.ctx),this.dispatchEvent("engine_rendered")}updatePerformanceStats(){this.frameCount++;const e=y.totalTime;e-this.lastFpsUpdate>=1e3&&(this.fpsCounter=Math.round(1e3*this.frameCount/(e-this.lastFpsUpdate)),this.frameCount=0,this.lastFpsUpdate=e)}getInputManager(){return this.inputManager}getAudioManager(){return this.audioManager}getResourceManager(){return this.resourceManager}getCollisionManager(){return this.collisionManager}getUIManager(){return this.uiManager}getCanvas(){return this.canvas}getContext(){return this.ctx}setTargetFPS(e){this.targetFPS=Math.max(1,e),this.frameTime=1e3/this.targetFPS}getTargetFPS(){return this.targetFPS}getCurrentFPS(){return this.fpsCounter}destroy(){this.stop(),this.currentScene&&this.currentScene.unload(),this.scenes.clear(),this.collisionManager.clear(),this.resourceManager.unloadAll(),this.audioManager.stopAllSounds(),this.removeAllEventListeners(),this.dispatchEvent("engine_destroyed")}}H.instance=null;const j={WIDTH:1e3,HEIGHT:800},U=200,F="Space",W="ArrowLeft",Y="ArrowUp",V="ArrowRight",K="KeyA",z="KeyD",J="KeyW";var X=function(e,t,s,i){return new(s||(s=Promise))(function(n,a){function o(e){try{h(i.next(e))}catch(e){a(e)}}function r(e){try{h(i.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,r)}h((i=i.apply(e,t||[])).next())})};class ${static start(e){var t,s,i,n,a;return X(this,void 0,void 0,function*(){let o=document.getElementById(null!==(t=e.canvasId)&&void 0!==t?t:"game-canvas");if(o||(o=document.createElement("canvas"),o.id=null!==(s=e.canvasId)&&void 0!==s?s:"game-canvas",document.body.appendChild(o)),this.engine=new H({canvasId:o.id,width:null!==(i=e.width)&&void 0!==i?i:j.WIDTH,height:null!==(n=e.height)&&void 0!==n?n:j.WIDTH,targetFPS:null!==(a=e.targetFPS)&&void 0!==a?a:60}),e.preloadAssets&&(yield this.preloadAssets(e.preloadAssets)),e.scenes){for(const t of e.scenes)this.engine.addScene(t.getName(),t);yield this.engine.setScene(e.scenes[0].getName())}this.engine.start()})}static getEngine(){return this.engine}static preloadAssets(e){return X(this,void 0,void 0,function*(){const t=this.engine.getResourceManager(),s=this.engine.getAudioManager(),i=e.images?e.images.map(e=>t.loadResource(e.name,e.url,a.IMAGE)):[],n=e.audio?e.audio.map(e=>s.loadSound(e.name,e.url)):[];yield Promise.all([...i,...n])})}static addScene(e,t){this.engine.addScene(e,t)}static setScene(e){return X(this,void 0,void 0,function*(){yield this.engine.setScene(e)})}}class q extends M{setFlip(e,t){this.scaleX=e,this.scaleY=t}constructor(e){super(e),this.color=D.WHITE,this.visible=!0,this.scaleX=1,this.scaleY=1,this.image=null,this.imageWidth=null,this.imageHeight=null}setImage(e){this.image=e}setColor(e){this.color=e}setVisible(e){this.visible=e}isVisible(){return this.visible&&this.isEnabled()}setImageSize(e,t){this.imageWidth=e,this.imageHeight=t}getWidth(){var e;return null!==(e=this.imageWidth)&&void 0!==e?e:this.image?this.image.width:50}getHeight(){var e;return null!==(e=this.imageHeight)&&void 0!==e?e:this.image?this.image.height:50}update(e){}render(e){var t,s;if(!this.isVisible())return;const i=this.gameObject.getComponent(P);if(!i)return;e.save();const n=i.getWorldPosition(),a=i.getWorldRotation(),o=i.getWorldScale();if(e.translate(n.x,n.y),e.rotate(a),e.scale(o.x*this.scaleX,o.y*this.scaleY),this.image){const i=null!==(t=this.imageWidth)&&void 0!==t?t:this.image.width,n=null!==(s=this.imageHeight)&&void 0!==s?s:this.image.height;e.drawImage(this.image,-i/2,-n/2,i,n)}else e.fillStyle=new D(this.color.r,this.color.g,this.color.b,this.color.a).toString(),e.fillRect(-25,-25,50,50);e.restore()}serialize(){return Object.assign(Object.assign({},super.serialize()),{color:this.color,visible:this.visible})}deserialize(e){super.deserialize(e),D.isRGBAColor(e.color)&&(this.color={r:e.color.r,g:e.color.g,b:e.color.b,a:e.color.a}),this.visible=!1!==e.visible}}class Q extends q{constructor(e){super(e),this.animations=new Map,this.currentAnimation=null,this.currentFrame=0,this.animationTime=0}addAnimation(e,t,s,i=100,n=!0){const a=s.getResourceManager(),o=[];for(const e of t){const t=a.getResource(e);t&&o.push(t)}this.animations.set(e,{name:e,frames:o,frameTime:i,loop:n,currentFrame:0})}playAnimation(e){const t=this.animations.get(e);t&&t!==this.currentAnimation&&(this.currentAnimation=t,this.currentFrame=0,this.animationTime=0,this.currentAnimation&&this.currentAnimation.frames.length>0&&(this.imageWidth=this.currentAnimation.frames[this.currentFrame].width,this.imageHeight=this.currentAnimation.frames[this.currentFrame].height))}update(e){super.update(e),this.currentAnimation&&(this.animationTime+=e,this.animationTime>=this.currentAnimation.frameTime&&(this.currentFrame++,this.animationTime=0,this.currentFrame>=this.currentAnimation.frames.length&&(this.currentAnimation.loop?this.currentFrame=0:this.currentFrame=this.currentAnimation.frames.length-1)))}render(e){if(!this.isVisible())return;const t=this.gameObject.getComponent(P);if(!t)return;e.save();const s=t.getWorldPosition(),i=t.getWorldRotation(),n=t.getWorldScale();if(e.translate(s.x,s.y),e.rotate(i),e.scale(n.x,n.y),this.currentAnimation&&this.currentAnimation.frames.length>0){const t=this.currentAnimation.frames[this.currentFrame];e.drawImage(t,-t.width/2,-t.height/2)}else this.image&&e.drawImage(this.image,-this.image.width/2,-this.image.height/2);e.restore()}}class Z{constructor(e){var t,s,i;this.isAlive=!0,this.position=new _(e.position.x,e.position.y),this.velocity=e.velocity?new _(e.velocity.x,e.velocity.y):_.zero(),this.acceleration=e.acceleration?new _(e.acceleration.x,e.acceleration.y):_.zero(),this.life=e.life,this.maxLife=e.life,this.size=e.size,this.originalSize=e.size,this.color=Object.assign({},e.color),this.fadeOut=null===(t=e.fadeOut)||void 0===t||t,this.shrink=null!==(s=e.shrink)&&void 0!==s&&s,this.gravity=null!==(i=e.gravity)&&void 0!==i&&i}update(e){if(!this.isAlive)return;const t=e/1e3;if(this.gravity&&(this.acceleration.y+=500*t),this.velocity=this.velocity.add(this.acceleration.multiply(t)),this.position=this.position.add(this.velocity.multiply(t)),this.life-=e,this.life<=0)return void(this.isAlive=!1);const s=this.life/this.maxLife;this.fadeOut&&(this.color.a=s),this.shrink&&(this.size=this.originalSize*s),this.acceleration=_.zero()}render(e){this.isAlive&&(e.save(),e.globalAlpha=this.color.a,e.fillStyle=new D(this.color.r,this.color.g,this.color.b,this.color.a).toString(),e.beginPath(),e.arc(this.position.x,this.position.y,this.size,0,2*Math.PI),e.fill(),e.restore())}}class ee extends M{constructor(e,t=1e3){super(e),this.particles=[],this.maxParticles=1e3,this.maxParticles=t}emit(e){this.particles.length>=this.maxParticles&&this.particles.shift();const t=new Z(e);this.particles.push(t)}emitBurst(e,t,s){for(let i=0;i<t;i++){const t=this.getPresetConfig(e,s);this.emit(t)}}emitExplosion(e,t=30){this.emitBurst(e,t,T.EXPLOSION)}emitStars(e,t=20){this.emitBurst(e,t,T.STARS)}emitSparkles(e,t=15){this.emitBurst(e,t,T.SPARKLES)}emitConfetti(e,t=50){this.emitBurst(e,t,T.CONFETTI)}emitHearts(e,t=10){this.emitBurst(e,t,T.HEARTS)}getPresetConfig(e,t){const s=L.random(0,2*Math.PI),i=L.random(50,200),n=_.fromAngle(s,i);switch(t){case T.EXPLOSION:return{position:e,velocity:n,life:L.random(500,1500),size:L.random(3,8),color:{r:L.random(200,255),g:L.random(100,200),b:L.random(0,100),a:1},fadeOut:!0,shrink:!0,gravity:!0};case T.STARS:return{position:e,velocity:_.fromAngle(s,L.random(30,100)),life:L.random(1e3,2e3),size:L.random(2,5),color:{r:255,g:255,b:L.random(200,255),a:1},fadeOut:!0,shrink:!1,gravity:!1};case T.SPARKLES:return{position:new _(e.x+L.random(-20,20),e.y+L.random(-20,20)),velocity:_.fromAngle(s,L.random(10,50)),life:L.random(300,800),size:L.random(1,3),color:{r:255,g:255,b:255,a:1},fadeOut:!0,shrink:!0,gravity:!1};case T.CONFETTI:{const t=[{r:255,g:0,b:0},{r:0,g:255,b:0},{r:0,g:0,b:255},{r:255,g:255,b:0},{r:255,g:0,b:255},{r:0,g:255,b:255}],i=L.randomChoice(t);return{position:e,velocity:_.fromAngle(s,L.random(100,300)),life:L.random(1e3,3e3),size:L.random(4,8),color:Object.assign(Object.assign({},i),{a:1}),fadeOut:!0,shrink:!1,gravity:!0}}case T.HEARTS:return{position:e,velocity:_.fromAngle(s,L.random(20,80)),life:L.random(1500,2500),size:L.random(6,12),color:{r:255,g:L.random(100,200),b:L.random(100,200),a:1},fadeOut:!0,shrink:!1,gravity:!1};default:return{position:e,velocity:n,life:1e3,size:5,color:D.WHITE,fadeOut:!0}}}update(e){this.particles.forEach(t=>{t.update(e)}),this.particles=this.particles.filter(e=>e.isAlive)}render(e){this.particles.forEach(t=>{t.render(e)})}clear(){this.particles=[]}getParticleCount(){return this.particles.length}}class te extends x{constructor(e,t="Button"){super(e,t),this.backgroundImage=null,this.particleSystem=null,this.isHovered=!1,this.scale=1,this.targetScale=1,this.glowIntensity=0,this.pulseTime=0,this.enableParticleSystem=!0,this.enableHoverEffect=!0,this.enableClickEffect=!0,this.enableGlow=!0,this.enablePulse=!1;const s=new v({name:"ButtonParticles"});this.particleSystem=new ee(s,50),this.normalColor=new D(70,130,255,1),this.hoverColor=new D(100,150,255,1),this.pressedColor=new D(50,110,230,1),this.cornerRadius=12,this.borderWidth=2,this.borderColor=new D(255,255,255,.3)}update(e){super.update(e),this.particleSystem&&this.particleSystem.update(e),this.updateHoverEffect(e),this.updatePulseEffect(e),this.updateGlowEffect(e)}updateHoverEffect(e){}updatePulseEffect(e){if(!this.enablePulse)return;this.pulseTime+=e;const t=.05*Math.sin(.003*this.pulseTime)+1;this.targetScale=t}updateGlowEffect(e){if(!this.enableGlow)return;const t=e/1e3*5,s=this.isHovered?1:0;this.glowIntensity+=(s-this.glowIntensity)*t}setBackgroundImage(e){this.backgroundImage=e,this.setText("")}handleMouseMove(e){const t=this.isHovered;super.handleMouseMove(e);const s=this.getWorldBounds();this.isHovered=e.x>=s.x&&e.x<=s.x+s.width&&e.y>=s.y&&e.y<=s.y+s.height,this.isHovered&&!t?this.onHoverStart():!this.isHovered&&t&&this.onHoverEnd()}handleMouseDown(e){if(super.handleMouseDown(e),this.enableClickEffect&&this.isHovered&&this.particleSystem){const e=this.getWorldBounds(),t=new _(e.x+e.width/2,e.y+e.height/2);this.particleSystem.emitSparkles(t,8)}}toggleParticleSystem(e){this.enableParticleSystem=e}onHoverStart(){if(this.targetScale=1.05,this.enableClickEffect&&this.particleSystem){const e=this.getWorldBounds(),t=new _(e.x+e.width/2,e.y+e.height/2);this.particleSystem.emitSparkles(t,3)}}onHoverEnd(){this.targetScale=1}onRender(e){const t=this.getWorldBounds();e.save(),this.enableGlow&&this.glowIntensity>0&&this.drawGlow(e,t),this.backgroundImage?e.drawImage(this.backgroundImage,t.x,t.y,t.width,t.height):super.onRender(e),this.particleSystem&&this.enableParticleSystem&&this.particleSystem.render(e),e.restore()}drawGlow(e,t){const s=20*this.glowIntensity,i=e.createRadialGradient(t.x+t.width/2,t.y+t.height/2,0,t.x+t.width/2,t.y+t.height/2,Math.max(t.width,t.height)/2+s);i.addColorStop(0,`rgba(100, 150, 255, ${.3*this.glowIntensity})`),i.addColorStop(1,"rgba(100, 150, 255, 0)"),e.fillStyle=i,e.fillRect(t.x-s,t.y-s,t.width+2*s,t.height+2*s)}}class se extends G{constructor(e,t=""){super(e,t),this.typewriterSpeed=50,this.fullText="",this.currentText="",this.typewriterTime=0,this.isTypewriting=!1,this.glowEffect=!1,this.shadowEffect=!0,this.rainbowEffect=!1,this.pulseEffect=!1,this.pulseTime=0,this.fullText=t,this.currentText="",this.shadowEffect=!0}startTypewriter(e=50){this.typewriterSpeed=e,this.isTypewriting=!0,this.typewriterTime=0,this.currentText=""}enableGlow(e=!0){this.glowEffect=e}enableRainbow(e=!0){this.rainbowEffect=e}enablePulse(e=!0){this.pulseEffect=e}setText(e){super.setText(e),this.fullText=e,this.isTypewriting||(this.currentText=e)}update(e){super.update(e),this.isTypewriting&&this.updateTypewriter(e),this.pulseEffect&&(this.pulseTime+=e)}updateTypewriter(e){this.typewriterTime+=e;const t=Math.floor(this.typewriterTime/1e3*this.typewriterSpeed);t>=this.fullText.length?(this.currentText=this.fullText,this.isTypewriting=!1):this.currentText=this.fullText.substring(0,t)}onRender(e){this.currentText||this.isTypewriting||(this.currentText=this.text);const t=this.getWorldBounds(),s=this.isTypewriting?this.currentText:this.text;if(!s)return;e.save(),e.font=this.font,e.textAlign=this.textAlign,e.textBaseline=this.textBaseline;const i=this.getTextX(t),n=this.getTextY(t);if(this.pulseEffect){const t=1+.1*Math.sin(.005*this.pulseTime);e.save(),e.translate(i,n),e.scale(t,t),e.translate(-i,-n)}this.glowEffect&&(e.shadowColor=new D(this.color.r,this.color.g,this.color.b,.8).toString(),e.shadowBlur=10),this.rainbowEffect?this.drawRainbowText(e,s,i,n):(this.shadowEffect&&(e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillText(s,i+2,n+2)),e.fillStyle=new D(this.color.r,this.color.g,this.color.b,this.color.a).toString(),e.fillText(s,i,n)),this.pulseEffect&&e.restore(),e.restore()}drawRainbowText(e,t,s,i){const n=.005*Date.now();for(let a=0;a<t.length;a++){const o=(n+10*a)%360,r=D.fromHSL({h:o,s:70,l:60});e.fillStyle=r.toString();const h=e.measureText(t.substring(0,a)).width;e.fillText(t[a],s+h,i)}}getTextX(e){switch(this.textAlign){case"left":default:return e.x+this.padding.left;case"center":return e.x+e.width/2;case"right":return e.x+e.width-this.padding.right}}getTextY(e){switch(this.textBaseline){case"top":default:return e.y+this.padding.top;case"middle":return e.y+e.height/2;case"bottom":return e.y+e.height-this.padding.bottom}}}class ie extends B{setBackgroundImage(e,t="stretch"){this.backgroundImage=e,this.backgroundImageMode=t}constructor(e){super(e),this.gradientColors=[],this.animatedGradient=!1,this.gradientTime=0,this.glassEffect=!1,this.borderGlow=!1,this.floatingEffect=!1,this.floatTime=0,this.floatAmplitude=5,this.backgroundImage=null,this.backgroundImageMode="stretch",this.gradientColors=[new D(50,50,100,.9),new D(30,30,80,.9)],this.cornerRadius=15,this.borderWidth=2}setGradient(e){this.gradientColors=[...e]}enableAnimatedGradient(e=!0){this.animatedGradient=e}enableGlassEffect(e=!0){this.glassEffect=e}enableBorderGlow(e=!0){this.borderGlow=e}enableFloating(e=!0,t=5){this.floatingEffect=e,this.floatAmplitude=t}update(e){super.update(e),this.animatedGradient&&(this.gradientTime+=e),this.floatingEffect&&(this.floatTime+=e)}onRender(e){const t=this.getWorldBounds();if(this.floatingEffect){const e=Math.sin(.002*this.floatTime)*this.floatAmplitude;t.y+=e}if(e.save(),e.globalAlpha=this.alpha,void 0===t)return;this.backgroundImage&&this.drawBackgroundImage(e,t);const s=this.createGradient(e,t);this.cornerRadius>0?(this.drawRoundedRect(e,t,this.cornerRadius),e.fillStyle=s,e.fill()):(e.fillStyle=s,e.fillRect(t.x,t.y,t.width,t.height)),this.glassEffect&&this.drawGlassEffect(e,t),this.borderWidth>0&&this.drawBorder(e,t),e.restore()}createGradient(e,t){const s=e.createLinearGradient(t.x,t.y,t.x,t.y+t.height);if(this.animatedGradient&&this.gradientColors.length>=2){const e=.001*this.gradientTime,t=Math.floor(e)%this.gradientColors.length,i=(t+1)%this.gradientColors.length,n=e-Math.floor(e),a=this.gradientColors[t],o=this.gradientColors[i];if(void 0===a||void 0===o)return s;const r=new D(a.r+(o.r-a.r)*n,a.g+(o.g-a.g)*n,a.b+(o.b-a.b)*n,a.a+(o.a-a.a)*n);s.addColorStop(0,r.toString()),s.addColorStop(1,o.toString?o.toString():new D(o.r,o.g,o.b,o.a).toString())}else this.gradientColors.forEach((e,t)=>{const i=t/(this.gradientColors.length-1),n=e.toString?e.toString():new D(e.r,e.g,e.b,e.a).toString();s.addColorStop(i,n)});return s}drawGlassEffect(e,t){const s=e.createLinearGradient(t.x,t.y,t.x,t.y+.3*t.height);s.addColorStop(0,"rgba(255, 255, 255, 0.3)"),s.addColorStop(1,"rgba(255, 255, 255, 0)"),this.cornerRadius>0?(this.drawRoundedRect(e,t,this.cornerRadius),e.fillStyle=s,e.fill()):(e.fillStyle=s,e.fillRect(t.x,t.y,t.width,.3*t.height))}drawBorder(e,t){this.borderGlow&&(e.shadowColor=new D(this.borderColor.r,this.borderColor.g,this.borderColor.b,.8).toString(),e.shadowBlur=10),this.cornerRadius>0?this.drawRoundedRect(e,t,this.cornerRadius):e.rect(t.x,t.y,t.width,t.height),e.strokeStyle=new D(this.borderColor.r,this.borderColor.g,this.borderColor.b,this.borderColor.a).toString(),e.lineWidth=this.borderWidth,e.stroke()}drawRoundedRect(e,t,s){e.beginPath(),e.moveTo(t.x+s,t.y),e.lineTo(t.x+t.width-s,t.y),e.quadraticCurveTo(t.x+t.width,t.y,t.x+t.width,t.y+s),e.lineTo(t.x+t.width,t.y+t.height-s),e.quadraticCurveTo(t.x+t.width,t.y+t.height,t.x+t.width-s,t.y+t.height),e.lineTo(t.x+s,t.y+t.height),e.quadraticCurveTo(t.x,t.y+t.height,t.x,t.y+t.height-s),e.lineTo(t.x,t.y+s),e.quadraticCurveTo(t.x,t.y,t.x+s,t.y),e.closePath()}drawBackgroundImage(e,t){if(!this.backgroundImage)return;const s=this.backgroundImage.width,i=this.backgroundImage.height;let n=t.x,a=t.y,o=t.width,r=t.height;if("cover"===this.backgroundImageMode){const e=Math.max(o/s,r/i),h=s*e,l=i*e;n=t.x+(o-h)/2,a=t.y+(r-l)/2,o=h,r=l}else if("contain"===this.backgroundImageMode){const e=Math.min(o/s,r/i),h=s*e,l=i*e;n=t.x+(o-h)/2,a=t.y+(r-l)/2,o=h,r=l}this.cornerRadius>0?(e.save(),this.drawRoundedRect(e,t,this.cornerRadius),e.clip(),e.drawImage(this.backgroundImage,0,0,s,i,n,a,o,r),e.restore()):e.drawImage(this.backgroundImage,0,0,s,i,n,a,o,r)}}class ne extends M{constructor(e,t=5){super(e),this.velocity=_.zero(),this.acceleration=_.zero(),this.mass=1,this.drag=.98,this.useGravity=!0,this.isKinematic=!1,this.isGrounded=!1,this.force=_.zero(),this.mass=t}addForce(e){this.isKinematic||(this.force=this.force.add(e))}setVelocity(e){this.velocity=new _(e.x,e.y)}getVelocity(){return new _(this.velocity.x,this.velocity.y)}update(e){if(!this.enabled||this.isKinematic)return;const t=.001*e;this.useGravity&&this.addForce(new _(ne.GRAVITY.x*this.mass,ne.GRAVITY.y*this.mass)),this.acceleration=new _(this.force.x/this.mass,this.force.y/this.mass),this.velocity=this.velocity.add(this.acceleration.multiply(t)),this.velocity=this.velocity.multiply(Math.pow(this.drag,t)),this.isGrounded&&this.velocity.y>0&&(this.velocity.y=0);const s=this.gameObject.getComponent(P);if(s){const e=this.velocity.multiply(t);this.isGrounded&&e.y>0&&(e.y=0),s.translate(e)}this.force=_.zero()}render(e){}serialize(){return Object.assign(Object.assign({},super.serialize()),{velocity:this.velocity,mass:this.mass,drag:this.drag,useGravity:this.useGravity,isKinematic:this.isKinematic})}deserialize(e){super.deserialize(e),_.isVector2(e.velocity)?this.velocity=new _(e.velocity.x,e.velocity.y):this.velocity=_.zero(),this.mass="number"==typeof e.mass?e.mass:1,this.drag="number"==typeof e.drag?e.drag:.98,this.useGravity=!1!==e.useGravity,this.isKinematic=!!e.isKinematic}}ne.GRAVITY=new _(0,900);class ae extends M{constructor(e){super(e),this.animations=new Map,this.activeAnimations=new Set}animate(e,t){const s=this.generateAnimationId(),i=new oe(e,t);return this.animations.set(s,i),this.activeAnimations.add(s),s}stopAnimation(e){const t=this.animations.get(e);t&&(t.stop(),this.activeAnimations.delete(e))}stopAllAnimations(){this.activeAnimations.forEach(e=>{this.stopAnimation(e)})}update(e){const t=[];this.activeAnimations.forEach(s=>{const i=this.animations.get(s);i&&(i.update(e),i.isComplete()&&t.push(s))}),t.forEach(e=>{const t=this.animations.get(e);t&&t.config.onComplete&&t.config.onComplete(),t&&!t.config.loop?(this.animations.delete(e),this.activeAnimations.delete(e)):t&&t.config.loop&&t.restart()})}generateAnimationId(){return`anim_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}render(e){}}class oe{constructor(e,t){this.startTime=0,this.currentTime=0,this.isRunning=!1,this.originalValues={position:new _(0,0),size:new _(0,0)},this.element=e,this.config=t,this.saveOriginalValues(),t.delay?setTimeout(()=>this.start(),t.delay):this.start()}saveOriginalValues(){this.originalValues={position:this.element.getGameObject().getPosition(),size:new _(this.element.size.x,this.element.size.y)}}start(){this.isRunning=!0,this.startTime=Date.now(),this.currentTime=0}stop(){this.isRunning=!1}restart(){this.currentTime=0,this.startTime=Date.now(),this.isRunning=!0}update(e){if(!this.isRunning)return;this.currentTime+=e;const t=Math.min(this.currentTime/this.config.duration,1),s=this.config.easing?this.config.easing(t):t;this.applyAnimation(s),t>=1&&(this.isRunning=!1)}applyAnimation(e){switch(this.config.type){case E.FadeIn:this.applyFadeIn(e);break;case E.FADE_OUT:this.applyFadeOut(e);break;case E.SLIDE_IN_FROM_TOP:this.applySlideFromTop(e);break;case E.SLIDE_IN_FROM_BOTTOM:this.applySlideFromBottom(e);break;case E.SLIDE_IN_FROM_LEFT:this.applySlideFromLeft(e);break;case E.SLIDE_IN_FROM_RIGHT:this.applySlideFromRight(e);break;case E.SLIDE_OUT_TO_TOP:this.applySlideOutToTop(e);break;case E.SLIDE_OUT_TO_BOTTOM:this.applySlideOutToBottom(e);break;case E.SLIDE_OUT_TO_LEFT:this.applySlideOutToLeft(e);break;case E.SLIDE_OUT_TO_RIGHT:this.applySlideOutToRight(e);break;case E.SCALE_IN:this.applyScaleIn(e);break;case E.SCALE_OUT:this.applyScaleOut(e);break;case E.BOUNCE:this.applyBounce(e);break;case E.PULSE:this.applyPulse(e);break;case E.SHAKE:this.applyShake(e)}}applyFadeIn(e){}applyFadeOut(e){}applySlideFromTop(e){const t=this.originalValues.position.y+-200*(1-e);this.element.getGameObject().setPosition(new _(this.originalValues.position.x,t))}applySlideFromBottom(e){const t=this.originalValues.position.y+200*(1-e);this.element.getGameObject().setPosition(new _(this.originalValues.position.x,t))}applySlideFromLeft(e){const t=this.originalValues.position.x+-200*(1-e);this.element.getGameObject().setPosition(new _(t,this.originalValues.position.y))}applySlideFromRight(e){const t=this.originalValues.position.x+200*(1-e);this.element.getGameObject().setPosition(new _(t,this.originalValues.position.y))}applySlideOutToTop(e){const t=this.originalValues.position.y+-200*e;this.element.getGameObject().setPosition(new _(this.originalValues.position.x,t))}applySlideOutToBottom(e){const t=this.originalValues.position.y+200*e;this.element.getGameObject().setPosition(new _(this.originalValues.position.x,t))}applySlideOutToLeft(e){const t=this.originalValues.position.x+-200*e;this.element.getGameObject().setPosition(new _(t,this.originalValues.position.y))}applySlideOutToRight(e){const t=this.originalValues.position.x+200*e;this.element.getGameObject().setPosition(new _(t,this.originalValues.position.y))}applyScaleIn(e){const t=e;this.element.size=new _(this.originalValues.size.x*t,this.originalValues.size.y*t)}applyScaleOut(e){const t=1-e;this.element.size=new _(this.originalValues.size.x*t,this.originalValues.size.y*t)}applyBounce(e){const t=20*Math.sin(e*Math.PI),s=this.originalValues.position.y-t;this.element.getGameObject().setPosition(new _(this.originalValues.position.x,s))}applyPulse(e){const t=1+.1*Math.sin(e*Math.PI*4);this.element.size=new _(this.originalValues.size.x*t,this.originalValues.size.y*t)}applyShake(e){const t=5*(1-e),s=(Math.random()-.5)*t,i=(Math.random()-.5)*t;this.element.getGameObject().setPosition(new _(this.originalValues.position.x+s,this.originalValues.position.y+i))}isComplete(){return!this.isRunning&&this.currentTime>=this.config.duration}}class re{static easeInQuad(e){return e*e}static easeOutQuad(e){return e*(2-e)}static easeInOutQuad(e){return e<.5?2*e*e:(4-2*e)*e-1}static easeInCubic(e){return e*e*e}static easeOutCubic(e){return--e*e*e+1}static easeInOutCubic(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}static easeInBounce(e){return 1-re.easeOutBounce(1-e)}static easeOutBounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}static easeInElastic(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-=1))*Math.sin((e-.075)*(2*Math.PI)/.3)}static easeOutElastic(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)+1}}class he extends O{setEnabled(e){this.enabled=e}isEnabled(){return this.enabled}setVisible(e){this.visible=e}isVisible(){return this.visible}setMainCamera(e){this.mainCamera=e,this.dispatchEvent("main_camera_set",{camera:e})}constructor(e){super(),this.gameObjects=new Map,this.gameObjectsByTag=new Map,this.gameObjectsByLayer=new Map,this.state=r.NOT_LOADED,this.loadProgress=0,this.mainCamera=null,this.enabled=!0,this.visible=!0,this.name=e}getName(){return this.name}getState(){return this.state}getLoadProgress(){return this.loadProgress}addGameObject(e){this.gameObjects.set(e.id,e),this.gameObjectsByTag.has(e.tag)||this.gameObjectsByTag.set(e.tag,new Set);const t=this.gameObjectsByTag.get(e.tag);t&&t.add(e),this.gameObjectsByLayer.has(e.layer)||this.gameObjectsByLayer.set(e.layer,new Set);const s=this.gameObjectsByLayer.get(e.layer);s&&s.add(e),this.state===r.LOADED&&(e.awake(),e.start()),this.dispatchEvent("game_object_added",{gameObject:e})}removeGameObject(e){if(!this.gameObjects.has(e.id))return;this.gameObjects.delete(e.id);const t=this.gameObjectsByTag.get(e.tag);t&&(t.delete(e),0===t.size&&this.gameObjectsByTag.delete(e.tag));const s=this.gameObjectsByLayer.get(e.layer);s&&(s.delete(e),0===s.size&&this.gameObjectsByLayer.delete(e.layer)),this.dispatchEvent("game_object_removed",{gameObject:e})}findGameObject(e){return this.gameObjects.get(e)||null}findGameObjectByName(e){for(const t of this.gameObjects.values())if(t.name===e)return t;return null}findGameObjectByTag(e){const t=this.gameObjectsByTag.get(e);return t&&Array.from(t)[0]||null}findGameObjectsByTag(e){const t=this.gameObjectsByTag.get(e);return t?Array.from(t):[]}getAllGameObjects(){return Array.from(this.gameObjects.values())}getGameObjectCount(){return this.gameObjects.size}load(){if(this.state===r.NOT_LOADED){this.state=r.LOADING,this.loadProgress=0;try{this.onLoad(),this.gameObjects.forEach(e=>{e.awake()}),this.gameObjects.forEach(e=>{e.start()}),this.state=r.LOADED,this.loadProgress=1,this.dispatchEvent("scene_loaded")}catch(e){throw this.state=r.NOT_LOADED,this.dispatchEvent("scene_load_error",{error:e}),e}}}unload(){if(this.state===r.LOADED){this.state=r.UNLOADING;try{this.gameObjects.forEach(e=>e.destroy()),this.gameObjects.clear(),this.gameObjectsByTag.clear(),this.gameObjectsByLayer.clear(),this.onUnload(),this.state=r.NOT_LOADED,this.loadProgress=0,this.dispatchEvent("scene_unloaded")}catch(e){throw this.dispatchEvent("scene_unload_error",{error:e}),e}}}update(e){if(this.state!==r.LOADED)return;const t=[];this.gameObjects.forEach((e,s)=>{e.isDestroyed()&&t.push(s)}),t.forEach(e=>{const t=this.gameObjects.get(e);t&&this.removeGameObject(t)}),this.gameObjects.forEach(t=>{t.isActive()&&t.update(e)}),this.onUpdate(e)}render(e){if(this.state!==r.LOADED)return;e.save();const t=this.getMainCamera();if(t){const s=t.getGameObject().getComponent(P);if(s){const t=s.getWorldPosition();e.translate(0,-t.y+j.HEIGHT/2)}}this.onRender(e),this.renderGameObjects(e),e.restore(),H.getInstance().getUIManager().render(e)}renderGameObjects(e){Array.from(this.gameObjects.values()).filter(e=>e.isActive()).sort((e,t)=>e.layer-t.layer).forEach(t=>{t.isVisible()&&t.render(e)})}getMainCamera(){return this.mainCamera}serialize(){const e={};return this.gameObjects.forEach((t,s)=>{e[s]=t.serialize()}),{name:this.name,gameObjects:e}}deserialize(e){"string"==typeof e.name&&(this.name=e.name),e.gameObjects&&Object.entries(e.gameObjects).forEach(([e,t])=>{const s=this.gameObjects.get(e);s&&t&&s.deserialize(t)})}}class le extends he{constructor(e="GameOverScene"){super(e),this.finalScore=0,this.highScore=0,this.isNewHighScore=!1,this.animationComplete=!1,this.celebrationTime=0}onLoad(){console.log("Loading Enhanced Game Over Scene..."),this.gameEngine=H.getInstance(),this.loadScores(),this.createEffectSystems(),this.createPlayerDead(),this.createUI(),this.playEntranceAnimation(),console.log("Enhanced Game Over Scene loaded!")}onUnload(){console.log("Unloading Enhanced Game Over Scene...");const e=this.gameEngine.getUIManager();e&&this.backgroundPanel&&e.removeRootElement(this.backgroundPanel)}loadScores(){try{const e=localStorage.getItem(R.HIGH_SCORE_KEY),t=localStorage.getItem(R.CURRENT_SCORE_KEY);this.finalScore=t?parseInt(t,10):0,this.highScore=e?parseInt(e,10):0,this.isNewHighScore=this.finalScore>=this.highScore,this.isNewHighScore&&(this.highScore=this.finalScore,localStorage.setItem(R.HIGH_SCORE_KEY,this.highScore.toString()))}catch(e){console.warn("Error loading scores:",e),this.finalScore=0,this.highScore=0}}createEffectSystems(){const e=new v({name:"GameOverAnimator"});this.animator=new ae(e),e.addComponent(this.animator),this.addGameObject(e);const t=new v({name:"GameOverParticles"});this.particleSystem=new ee(t,300),t.addComponent(this.particleSystem),this.addGameObject(t)}createUI(){this.createBackgroundPanel(),this.createGameOverTitle(),this.createScorePanel(),this.createButtons(),this.addUIToManager()}createPlayerDead(){const e=new v({name:"PlayerDead",position:new _(j.WIDTH/2,-j.HEIGHT/2)}),t=new ne(e,1);t.useGravity=!0;const s=new Q(e);s.addAnimation(R.ANIMATIONS.PLAYER_DEAD.Name,R.ANIMATIONS.PLAYER_DEAD.Frames,this.gameEngine,R.ANIMATIONS.PLAYER_DEAD.FrameRate,R.ANIMATIONS.PLAYER_DEAD.Loop),s.playAnimation(R.ANIMATIONS.PLAYER_DEAD.Name),e.addComponent(t),e.addComponent(s),this.addGameObject(e)}createBackgroundPanel(){const e=new v({name:"GameOverPanel",position:new _(-j.WIDTH,-j.HEIGHT)});this.backgroundPanel=new ie(e),this.backgroundPanel.setAnchor(d.MIDDLE_CENTER),this.backgroundPanel.size=new _(j.WIDTH,j.HEIGHT),this.backgroundPanel.setGradient([new D(0,0,0,0),new D(0,0,0,0),new D(0,0,0,0)]),this.backgroundPanel.cornerRadius=0,this.backgroundPanel.borderWidth=0;const t=new v({name:"BackgroundRenderer",position:new _(j.WIDTH/2,j.HEIGHT/2),layer:-100}),s=new q(t),i=H.getInstance().getResourceManager().getResource(R.IMAGES.BACKGROUND.GAMEPLAY_BACKGROUND);s.setImage(i),s.setImageSize(j.WIDTH,j.HEIGHT),t.addComponent(s),e.addComponent(this.backgroundPanel),this.addGameObject(t),this.addGameObject(e)}createGameOverTitle(){const e=new v({name:"GameOverTitle",position:new _(j.WIDTH/2-250,100)});this.gameOverLabel=new se(e,"GAME OVER"),this.gameOverLabel.setAnchor(d.MIDDLE_CENTER),this.gameOverLabel.setFont('42px "Arial Black", Arial'),this.gameOverLabel.setColor(new D(255,100,100,1)),this.gameOverLabel.setTextAlign("center"),this.gameOverLabel.setTextBaseline("middle"),this.gameOverLabel.size=new _(500,60),this.gameOverLabel.enableGlow(!0),this.gameOverLabel.enablePulse(!0),e.addComponent(this.gameOverLabel),e.setActive(!1),this.backgroundPanel.addChild(this.gameOverLabel)}createScorePanel(){const e=new v({name:"ScorePanel",position:new _(j.WIDTH/2-200,300)});this.scorePanel=new ie(e),this.scorePanel.setAnchor(d.MIDDLE_CENTER),this.scorePanel.size=new _(0,0),this.scorePanel.setGradient([new D(0,0,0,0),new D(0,0,0,0)]),this.scorePanel.cornerRadius=0,this.scorePanel.borderWidth=0,e.addComponent(this.scorePanel),this.backgroundPanel.addChild(this.scorePanel);const t=new v({name:"FinalScoreLabel",position:new _(0,-60)});this.finalScoreLabel=new se(t,`Your Score: ${this.finalScore}`),this.finalScoreLabel.setAnchor(d.MIDDLE_CENTER),this.finalScoreLabel.setFont('28px "Arial Black", Arial'),this.finalScoreLabel.setColor(new D(255,255,100,1)),this.finalScoreLabel.setTextAlign("center"),this.finalScoreLabel.size=new _(400,40),this.finalScoreLabel.enableGlow(!0),t.addComponent(this.finalScoreLabel),this.scorePanel.addChild(this.finalScoreLabel),t.setActive(!1);const s=new v({name:"HighScoreLabel",position:new _(0,-10)}),i=this.isNewHighScore?`NEW HIGH SCORE: ${this.highScore}`:`High Score: ${this.highScore}`;this.highScoreLabel=new se(s,i),this.highScoreLabel.setAnchor(d.MIDDLE_CENTER),this.highScoreLabel.setFont("20px Arial"),this.highScoreLabel.setColor(this.isNewHighScore?new D(255,215,0,1):new D(200,200,255,1)),this.highScoreLabel.setTextAlign("center"),this.highScoreLabel.size=new _(400,30),this.highScoreLabel.getGameObject().setActive(!1),s.addComponent(this.highScoreLabel),this.scorePanel.addChild(this.highScoreLabel);const n=new v({name:"PerformanceLabel",position:new _(0,40)}),a=this.getPerformanceMessage();this.performanceLabel=new se(n,a),this.performanceLabel.setAnchor(d.MIDDLE_CENTER),this.performanceLabel.setFont("16px Arial"),this.performanceLabel.setColor(new D(180,180,255,.8)),this.performanceLabel.setTextAlign("center"),this.performanceLabel.size=new _(400,25),n.setActive(!1),n.addComponent(this.performanceLabel),this.scorePanel.addChild(this.performanceLabel),e.setActive(!1)}createButtons(){const e=new v({name:"RestartButton",position:new _(j.WIDTH/2-250,j.HEIGHT/2+75)});this.restartButton=new te(e,"PLAY AGAIN"),this.restartButton.setAnchor(d.MIDDLE_CENTER),this.restartButton.size=new _(200,60),this.restartButton.setColors(new D(50,200,50,1),new D(255,255,255,1),new D(80,230,80,1)),this.restartButton.enableHoverEffect=!0,this.restartButton.enableClickEffect=!0,this.restartButton.enableGlow=!0,this.restartButton.setOnClick(()=>this.onRestartClick()),e.addComponent(this.restartButton),this.backgroundPanel.addChild(this.restartButton),e.setActive(!1);const t=new v({name:"MenuButton",position:new _(j.WIDTH/2+50,j.HEIGHT/2+75)});this.menuButton=new te(t,"MENU"),this.menuButton.setAnchor(d.MIDDLE_CENTER),this.menuButton.size=new _(200,60),this.menuButton.setColors(new D(100,100,200,1),new D(255,255,255,1),new D(130,130,230,1)),this.menuButton.enableHoverEffect=!0,this.menuButton.enableClickEffect=!0,this.menuButton.setOnClick(()=>this.onMenuClick()),t.addComponent(this.menuButton),this.backgroundPanel.addChild(this.menuButton),t.setActive(!1)}addUIToManager(){const e=this.gameEngine.getUIManager();e&&this.backgroundPanel&&e.addRootElement(this.backgroundPanel)}playEntranceAnimation(){this.animator.animate(this.backgroundPanel,{type:E.FadeIn,duration:800,easing:re.easeOutCubic}),setTimeout(()=>{this.gameOverLabel.getGameObject().setActive(!0),this.animator.animate(this.gameOverLabel,{type:E.SLIDE_IN_FROM_TOP,duration:600,easing:re.easeOutBounce})},300),setTimeout(()=>{this.scorePanel.getGameObject().setActive(!0),this.animator.animate(this.scorePanel,{type:E.SCALE_IN,duration:500,easing:re.easeOutElastic})},800),setTimeout(()=>{this.finalScoreLabel.getGameObject().setActive(!0),this.finalScoreLabel.startTypewriter(40)},1200),setTimeout(()=>{this.highScoreLabel.getGameObject().setActive(!0),this.highScoreLabel.startTypewriter(50)},1800),setTimeout(()=>{this.performanceLabel.getGameObject().setActive(!0),this.performanceLabel.startTypewriter(50)},2400),setTimeout(()=>{this.restartButton.getGameObject().setActive(!0),this.animator.animate(this.restartButton,{type:E.SLIDE_IN_FROM_BOTTOM,duration:400,easing:re.easeOutQuad})},2800),setTimeout(()=>{this.menuButton.getGameObject().setActive(!0),this.animator.animate(this.menuButton,{type:E.SLIDE_IN_FROM_BOTTOM,duration:300,easing:re.easeOutQuad})},3e3),this.isNewHighScore&&this.startCelebration()}startCelebration(){if(!this.isNewHighScore)return;const e=new _(j.WIDTH/2,j.HEIGHT/2);this.particleSystem.emitConfetti(e,50);for(let e=0;e<8;e++)setTimeout(()=>{const e=Math.random()*j.WIDTH,t=Math.random()*j.HEIGHT;this.particleSystem.emitHearts(new _(e,t),3)},200*e)}getPerformanceMessage(){return 0===this.finalScore?"Try again!":this.finalScore<100?"Keep practicing!":this.finalScore<500?"Not bad!":this.finalScore<1e3?"Good job!":this.finalScore<2e3?"Excellent!":"AMAZING!"}onRestartClick(){if(console.log("Restarting game..."),this.particleSystem){const e=this.restartButton.getWorldBounds(),t=new _(e.x+e.width/2,e.y+e.height/2);this.particleSystem.emitSparkles(t,10)}setTimeout(()=>{this.gameEngine.setScene("GameplayScene")},200)}onMenuClick(){console.log("Going to menu..."),setTimeout(()=>{this.gameEngine.setScene("MainMenuScene")},200)}setScores(e,t){if(this.finalScore=e,this.highScore=t,this.isNewHighScore=e>t,this.finalScoreLabel&&this.finalScoreLabel.setText(`Your Score: ${this.finalScore}`),this.highScoreLabel){const e=this.isNewHighScore?`NEW HIGH SCORE: ${this.highScore}`:`High Score: ${this.highScore}`;this.highScoreLabel.setText(e)}}onUpdate(e){if(this.celebrationTime+=e,this.isNewHighScore&&this.animationComplete&&Math.random()<.02){const e=Math.random()*j.WIDTH,t=Math.random()*j.HEIGHT;this.particleSystem.emitStars(new _(e,t),2)}}onRender(e){e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,j.WIDTH,j.HEIGHT),this.particleSystem&&this.particleSystem.render(e),this.isNewHighScore&&this.animationComplete&&this.drawCelebrationEffects(e),this.drawMobileInstructions(e)}drawCelebrationEffects(e){const t=.005*this.celebrationTime;e.save(),e.strokeStyle=`hsla(${60*t%360}, 70%, 60%, 0.5)`,e.lineWidth=5+3*Math.sin(2*t),e.strokeRect(10,10,j.WIDTH-20,j.HEIGHT-20),e.restore()}drawMobileInstructions(e){"ontouchstart"in window&&this.animationComplete&&(e.save(),e.fillStyle="rgba(255, 255, 255, 0.8)",e.font="16px Arial",e.textAlign="center",e.fillText("Tap to play again",j.WIDTH/2,j.HEIGHT-20),e.restore())}}class ce extends M{constructor(e){super(e),this.type=l.ORTHOGRAPHIC,this.size=5,this.fieldOfView=60,this.target=null,this.followSmoothing=5,this.shakeIntensity=0,this.shakeDuration=0,this.shakeOffset=_.zero()}setTarget(e){this.target=e}shake(e,t){this.shakeIntensity=e,this.shakeDuration=t}worldToScreen(e,t){const s=this.gameObject.getComponent(P);if(!s)throw new Error("Transform component not found on gameObject.");const i=s.getWorldPosition().add(this.shakeOffset);return new _(e.x-i.x+t.x/2,e.y-i.y+t.y/2)}screenToWorld(e,t){const s=this.gameObject.getComponent(P);if(!s)throw new Error("Transform component not found on gameObject.");const i=s.getWorldPosition().add(this.shakeOffset);return new _(e.x-t.x/2+i.x,e.y-t.y/2+i.y)}isInView(e,t){const s=this.getViewBounds(t);return this.boundsOverlap(s,e)}getViewBounds(e){const t=this.gameObject.getComponent(P);if(!t)throw new Error("Transform component not found on gameObject.");const s=t.getWorldPosition().add(this.shakeOffset),i=e.x/2,n=e.y/2;return{x:s.x-i,y:s.y-n,width:e.x,height:e.y}}boundsOverlap(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}update(e){if(this.enabled){if(this.target){const t=this.target.getPosition(),s=this.gameObject.getComponent(P);if(!s)throw new Error("Transform component not found on gameObject.");const i=s.getWorldPosition();if(this.followSmoothing>0){const n=_.lerp(i,t,this.followSmoothing*e/1e3);s.setPosition(n)}else s.setPosition(new _(t.x,t.y))}if(this.shakeDuration>0)if(this.shakeDuration-=e,this.shakeDuration>0){const e=Math.random()*Math.PI*2,t=this.shakeIntensity*(this.shakeDuration/1e3);this.shakeOffset=_.fromAngle(e,t)}else this.shakeOffset=_.zero()}}render(e){}serialize(){return Object.assign(Object.assign({},super.serialize()),{type:this.type,size:this.size,fieldOfView:this.fieldOfView,followSmoothing:this.followSmoothing})}deserialize(e){super.deserialize(e),this.type="string"==typeof e.type?e.type:l.ORTHOGRAPHIC,this.size="number"==typeof e.size?e.size:5,this.fieldOfView="number"==typeof e.fieldOfView?e.fieldOfView:60}}class de extends M{constructor(e,t=i.BOX){super(e),this.type=i.BOX,this.width=50,this.height=50,this.radius=25,this.offset=_.zero(),this.isTrigger=!1,this.layers=[n.DEFAULT],this.mask=[n.ALL],this.type=t}static createBox(e,t,s,n){const a=new de(e,i.BOX);return a.width=t,a.height=s,n&&(a.offset=n),a}static createCircle(e,t,s){const n=new de(e,i.CIRCLE);return n.radius=t,s&&(n.offset=s),n}getBounds(){const e=this.gameObject.getComponent(P);if(!e)return{x:0,y:0,width:0,height:0};const t=e.getWorldPosition(),s=new _(t.x+this.offset.x,t.y+this.offset.y);switch(this.type){case i.BOX:return{x:s.x-this.width/2,y:s.y-this.height/2,width:this.width,height:this.height};case i.CIRCLE:return{x:s.x-this.radius,y:s.y-this.radius,width:2*this.radius,height:2*this.radius};case i.POLYGON:return{x:s.x-this.width/2,y:s.y-this.height/2-this.height/20,width:this.width,height:this.height/20};default:return{x:s.x,y:s.y-this.renderer.getHeight()/2,width:this.width,height:this.height}}}setColliderSize(e,t){this.width=e,this.height=t}setRenderer(e){this.renderer=e,e&&(this.width=e.getWidth(),this.height=e.getHeight(),this.radius=Math.max(this.width,this.height)/2)}setColliderType(e){this.type=e,e===i.CIRCLE?this.radius=Math.max(this.width,this.height)/2:this.radius=0}onCollision(e,t){this.isTrigger?this.dispatchEvent(g,{other:e,collisionInfo:t}):this.dispatchEvent(m,{other:e,collisionInfo:t})}onCollisionExit(e){this.isTrigger?this.dispatchEvent("trigger_exit",{other:e}):this.dispatchEvent(p,{other:e})}getCollisionLayers(){return this.layers}getCollisionMask(){return this.mask}setCollisionLayers(e){this.layers=e}setCollisionMask(e){this.mask=e}canCollideWith(e){const t=this.mask.some(t=>e.layers.includes(t)),s=e.mask.some(e=>this.layers.includes(e));return t&&s}update(e){}render(e){}serialize(){return Object.assign(Object.assign({},super.serialize()),{type:this.type,width:this.width,height:this.height,radius:this.radius,offset:this.offset,isTrigger:this.isTrigger,layers:this.layers,mask:this.mask})}deserialize(e){super.deserialize(e),this.type="string"==typeof e.type?e.type:i.BOX,this.width="number"==typeof e.width?e.width:50,this.height="number"==typeof e.height?e.height:50,this.radius="number"==typeof e.radius?e.radius:25,_.isVector2(e.offset)?this.offset=new _(e.offset.x,e.offset.y):this.offset=_.zero(),this.isTrigger="boolean"==typeof e.isTrigger&&e.isTrigger,this.layers=Array.isArray(e.layers)?e.layers:[n.DEFAULT],this.mask=Array.isArray(e.mask)?e.mask:[n.ALL]}}const ue="player_hit_obstacle";var ge;!function(e){e.IDLE="idle",e.MOVING_LEFT="moving_left",e.MOVING_RIGHT="moving_right",e.ON_PLATFORM="on_platform",e.IN_AIR="in_air"}(ge||(ge={}));class me extends M{constructor(e){super(e),this.hasObject=!1,this.type="normal",this.object=null}onAwake(){const e=this.gameObject.getComponent(q);e&&e.setColor(D.GREEN)}updateObjectStatus(e){this.hasObject=e}containsObject(){return this.hasObject}setObject(e){this.object=e}getObject(){return this.object}update(e){}render(e){}getPlatformType(){return this.type}setPlatformType(e){this.type=e}}class pe extends me{constructor(e){super(e),this.isBroken=!1,this.breakableImg=H.getInstance().getResourceManager().getResource(R.IMAGES.BREAKABLE_PLATFORM),this.brokenImg=H.getInstance().getResourceManager().getResource(R.IMAGES.BROKEN_PLATFORM);const t=this.gameObject.getComponent(q);t&&t.setImage(this.breakableImg);const s=new ne(this.gameObject,1);s.useGravity=!1,s.isKinematic=!0,this.gameObject.addComponent(s),this.setPlatformType("breakable"),this.gameObject.tag="breakable_platform"}isPlatformBroken(){return this.isBroken}breakPlatform(){if(this.isBroken)return;this.isBroken=!0;const e=this.gameObject.getComponent(q);e&&e.setImage(this.brokenImg);const t=this.gameObject.getComponent(ne);t&&(t.useGravity=!0,t.isKinematic=!1),H.getInstance().getAudioManager().playSound(R.AUDIO.SFX.PLATFORM_BREAK)}}class Ee extends M{render(e){}constructor(e){super(e),this.scene=null,this.speed=1500,this.onAwake()}onAwake(){this.gameEngine=H.getInstance(),this.scene=this.gameEngine.getCurrentScene();const e=new Q(this.gameObject);e.addAnimation(R.ANIMATIONS.PROJECTILE.Name,R.ANIMATIONS.PROJECTILE.Frames,this.gameEngine,R.ANIMATIONS.PROJECTILE.FrameRate,R.ANIMATIONS.PROJECTILE.Loop);const t=new de(this.gameObject);t.setColliderSize(e.getWidth(),e.getHeight()),t.setColliderType(i.BOX),t.layers=[n.PLAYER],t.mask=[n.ENVIRONMENT],t.isTrigger=!0,this.gameObject.addComponent(t),this.gameObject.addComponent(e),e.playAnimation(R.ANIMATIONS.PROJECTILE.Name);const s=new ne(this.gameObject);s.useGravity=!1,s.setVelocity(new _(0,-this.speed)),this.gameObject.addComponent(s),this.scene&&this.scene.addGameObject(this.gameObject),this.gameEngine.getCollisionManager().addCollider(t)}update(e){const t=this.gameObject.getPosition();if(this.scene){const e=this.scene.getMainCamera();e&&t.y<e.getGameObject().getPosition().y-j.HEIGHT/2&&this.deactivate()}}deactivate(){const e=this.gameObject.getComponent(de);e&&H.getInstance()&&H.getInstance().getCollisionManager().removeCollider(e),this.scene&&this.scene.removeGameObject(this.gameObject),this.gameObject.destroy()}}class Te extends M{constructor(e){super(e),this.isGrounded=!1,this.isUsingJetpack=!1,this.jetpack=R.ITEMS.JETPACK,this.currentFuel=0,this.isDead=!1,this.inputLeft=!1,this.inputRight=!1,this.inputShoot=!1,this.shootCooldown=0,this.SHOOT_INTERVAL=800}onAwake(){const e=this.gameObject.getComponent(P);if(!e)return void console.error("Player missing Transform component!");const t=this.gameObject.getComponent(ne);if(!t)return void console.error("Player missing RigidBody component!");const s=this.gameObject.getComponent(de);if(!s)return void console.error("Player missing Collider component!");const a=this.gameObject.getComponent(Q);a?(this.transform=e,this.rigidBody=t,this.collider=s,this.animatedRenderer=a,this.animatedRenderer.setVisible(!0),this.collider.setColliderSize(this.animatedRenderer.getWidth()-48,this.animatedRenderer.getHeight()),this.collider.setColliderType(i.BOX),this.collider.layers=[n.PLAYER],this.collider.mask=[n.GROUND,n.ENVIRONMENT],this.collider.addEventListener(m,this.onCollisionEnter.bind(this)),this.collider.addEventListener(p,this.onCollisionExit.bind(this)),this.addEventListener(ue,this.onPlayerHitObstacle.bind(this)),H.getInstance().getCollisionManager().addCollider(this.collider),this.gameObject.tag="Player"):console.error("Player missing AnimatedRenderer component!")}setInput(e,t,s){this.inputLeft=e,this.inputRight=t,this.inputShoot=s}update(e){this.transform&&this.rigidBody&&(this.handleInput(),this.updateMovement(),this.checkBounds(),this.updateVisuals(),this.handleJetpack(e),this.updateAudio(),this.shootCooldown>0&&(this.shootCooldown-=e))}setUsingJetpack(e){this.isUsingJetpack=e,this.currentFuel=e?this.jetpack.FUEL:0}handleJetpack(e){if(!this.isUsingJetpack)return;if(this.isDead||this.currentFuel<=0)return void this.setUsingJetpack(!1);const t=.001*e;this.currentFuel-=this.jetpack.FUEL_CONSUMPTION_RATE*t,this.currentFuel<=0&&this.setUsingJetpack(!1)}handleInput(){if(this.isDead)return;const e=this.rigidBody.getVelocity();this.inputLeft?this.rigidBody.setVelocity(new _(-R.PLAYER.MOVE_SPEED,e.y)):this.inputRight?this.rigidBody.setVelocity(new _(R.PLAYER.MOVE_SPEED,e.y)):this.rigidBody.setVelocity(new _(.8*e.x,e.y)),this.inputShoot&&this.shoot(),this.isUsingJetpack&&this.jump()}jump(){this.isUsingJetpack||H.getInstance().getAudioManager().playSound(R.AUDIO.SFX.JUMP),this.rigidBody.setVelocity(new _(this.rigidBody.getVelocity().x,R.PLAYER.JUMP_FORCE)),this.isGrounded=!1}shoot(){if(this.isDead)return;if(this.shootCooldown>0)return;this.shootCooldown=this.SHOOT_INTERVAL;const e=new v({name:"Projectile",position:this.transform.getWorldPosition(),tag:"Projectile",layer:10});e.addComponent(new Ee(e)),H.getInstance().getAudioManager().playSound(R.AUDIO.SFX.SHOOT)}updateMovement(){const e=this.rigidBody.getVelocity();e.y>R.PLAYER.MAX_FALL_SPEED&&this.rigidBody.setVelocity(new _(e.x,R.PLAYER.MAX_FALL_SPEED))}checkBounds(){const e=this.transform.getWorldPosition();e.x<this.collider.width/2?this.transform.setPosition(new _(j.WIDTH+this.collider.width/2,e.y)):e.x>j.WIDTH+this.collider.width/2&&this.transform.setPosition(new _(this.collider.width/2,e.y))}updateVisuals(){if(!this.animatedRenderer)return;if(this.isDead)return;const e=this.rigidBody.getVelocity();this.isUsingJetpack?e.x>1?this.animatedRenderer.playAnimation(R.ANIMATIONS.PLAYER_MOVE_RIGHT_JETPACK.Name):e.x<-1?this.animatedRenderer.playAnimation(R.ANIMATIONS.PLAYER_MOVE_LEFT_JETPACK.Name):this.animatedRenderer.playAnimation(R.ANIMATIONS.PLAYER_IDLE_JETPACK.Name):e.x>1?this.animatedRenderer.playAnimation(R.ANIMATIONS.PLAYER_MOVE_RIGHT.Name):e.x<-1?this.animatedRenderer.playAnimation(R.ANIMATIONS.PLAYER_MOVE_LEFT.Name):this.animatedRenderer.playAnimation(R.ANIMATIONS.PLAYER_IDLE.Name)}updateAudio(){if(this.isDead)return;const e=this.rigidBody.getVelocity();this.isGrounded&&(e.x>1||e.x<-1)&&H.getInstance().getAudioManager().playSound(R.AUDIO.SFX.WALK)}onCollisionEnter(e){const{other:t,collisionInfo:s}=e.data;if(!t.isTrigger&&this.rigidBody.velocity.y>0&&this.transform.getWorldPosition().y+.75*this.collider.height<(()=>{const e=t.getGameObject().getComponent(P);return e?e.getWorldPosition().y:0})()){if("breakable_platform"===t.getGameObject().tag){const e=t.getGameObject().getComponent(pe);e&&e.breakPlatform()}this.rigidBody.isGrounded||(this.rigidBody.isGrounded=!0);const e=this.gameObject.getComponent(P),s=t.getGameObject().getComponent(P);e&&s&&this.transform.setPosition(new _(e.getWorldPosition().x,s.getWorldPosition().y-t.height/2-this.collider.height/2+8)),this.isGrounded=!0,this.rigidBody.setVelocity(new _(this.rigidBody.getVelocity().x,0)),this.jump()}}onCollisionExit(e){const{other:t}=e.data;this.isGrounded=!1,this.rigidBody.isGrounded=!1}onPlayerHitObstacle(e){this.isDead||(this.isDead=!0,this.gameObject.removeComponent(de),H.getInstance().getCollisionManager().removeCollider(this.collider),this.rigidBody.setVelocity(new _(0,R.PLAYER.JUMP_FORCE)),this.animatedRenderer.playAnimation(R.ANIMATIONS.PLAYER_DEAD.Name),this.getGameObject().destroy)}getScore(){if(!this.transform)return 0;const e=j.HEIGHT-150,t=this.transform.getWorldPosition().y;return Math.max(0,Math.floor((e-t)/10))}setPlayerDead(e){this.isDead=e}isPlayerDead(){return this.isDead}render(e){}}class ye extends ce{constructor(e){super(e),this.offset=new _(0,U),this.smoothing=5,this.highestY=0,this.playerDeadTimer=0,this.hasPlayerDied=!1,this.DEAD_FOLLOW_DURATION=1}setTarget(e){if(this.target=e,e){this.highestY=e.getPosition().y;const t=e.getComponent(Te);t?this.player=t:console.warn("CameraFollow: Target does not have a Player component.")}}setOffset(e){this.offset=e.clone()}setSmoothing(e){this.smoothing=e}update(e){if(super.update(e),!this.target)return;const t=this.gameObject.getComponent(P);if(!t)return void console.warn("CameraFollow: GameObject does not have a Transform component.");const s=this.target.getPosition(),i=t.getWorldPosition();s.y<this.highestY&&(this.highestY=s.y);const n=this.highestY+this.offset.y-100,a=new _(j.WIDTH/2,n);if(this.player&&(this.player.isPlayerDead()?this.hasPlayerDied?this.playerDeadTimer+=e/1e3:(this.hasPlayerDied=!0,this.playerDeadTimer=0):(this.hasPlayerDied=!1,this.playerDeadTimer=0)),this.player&&!this.player.isPlayerDead())t.setPosition(a);else if(this.hasPlayerDied&&this.playerDeadTimer<=this.DEAD_FOLLOW_DURATION){const n=e/1e3,a=_.lerp(i,s,this.smoothing*n);t.setPosition(a)}}getCameraViewBounds(){const e=this.gameObject.getComponent(P);if(!e)throw new Error("Transform component not found on gameObject.");const t=e.getWorldPosition();return{top:t.y-j.HEIGHT/2,bottom:t.y+j.HEIGHT/2,left:t.x-j.WIDTH/2,right:t.x+j.WIDTH/2}}isInView(e,t){const s=this.getCameraViewBounds();return e.x+e.width>s.left&&e.x<s.right&&e.y+e.height>s.top&&e.y<s.bottom}}class Ae extends M{constructor(e,t=R.BACKGROUND.CLOUD.MOVE_SPEED){super(e),this.speed=t,this.direction=L.randomSign()}update(e){const t=this.gameObject.getComponent(P);if(!t)return;const s=t.getWorldPosition(),i=s.x+this.direction*this.speed*(e/1e3);i<-R.BACKGROUND.CLOUD.WIDTH?t.setPosition(new _(j.WIDTH+R.BACKGROUND.CLOUD.WIDTH,s.y)):i>j.WIDTH+R.BACKGROUND.CLOUD.WIDTH?t.setPosition(new _(-R.BACKGROUND.CLOUD.WIDTH,s.y)):t.setPosition(new _(i,s.y))}render(e){}}class Oe extends M{constructor(e,t){super(e),this.clouds=[],this.camera=null,this.scene=t}setCamera(e){this.camera=e}onStart(){this.bgImage=H.getInstance().getResourceManager().getResource(R.IMAGES.BACKGROUND.GAMEPLAY_BACKGROUND),this.cloudImage=H.getInstance().getResourceManager().getResource(R.IMAGES.CLOUD),this.generateClouds()}update(e){this.manageClouds()}generateClouds(){for(let e=0;e<R.BACKGROUND.CLOUD.COUNT;e++)this.createCloud(new _(L.random(0,j.WIDTH),L.random(-500,j.HEIGHT)))}createCloud(e){const t=new v({name:"Cloud",tag:"Background",layer:1,position:e}),s=new q(t);s.setColor(new D(255,255,255,.7)),s.setImage(this.cloudImage),s.setImageSize(R.BACKGROUND.CLOUD.WIDTH,R.BACKGROUND.CLOUD.HEIGHT),t.addComponent(s);const i=new Ae(t);return t.addComponent(i),this.scene.addGameObject(t),this.clouds.push(t),t}manageClouds(){if(!this.camera)return;const e=this.camera.getGameObject().getComponent(P);if(!e)return;const t=e.getWorldPosition().y,s=t-j.HEIGHT/2-200,i=t+j.HEIGHT/2+200;for(this.clouds=this.clouds.filter(e=>!(e.getPosition().y>i+300&&(this.scene.removeGameObject(e),e.destroy(),1)));this.clouds.length<R.BACKGROUND.CLOUD.COUNT;)this.createCloud(new _(L.random(0,j.WIDTH),s-L.random(50,200)))}render(e){this.renderImageBackground(e)}renderImageBackground(e){if(!this.camera)return;const t=this.camera.getGameObject().getComponent(P);if(!t)return;if(!this.bgImage)return;const s=t.getWorldPosition().y;e.drawImage(this.bgImage,0,s-j.HEIGHT/2,j.WIDTH,j.HEIGHT)}}class fe extends M{constructor(e,t){super(e),this.player=null,this.leftPressed=!1,this.rightPressed=!1,this.shootPressed=!1,this.isTouching=!1,this.inputManager=t,this.setupTouchEvents()}setPlayer(e){this.player=e}update(e){this.handleKeyboardInput(),this.handleMouseInput(),this.handleTouchInput(),this.sendInputToPlayer()}handleKeyboardInput(){this.leftPressed=this.inputManager.isKeyPressed(W)||this.inputManager.isKeyPressed(K),this.rightPressed=this.inputManager.isKeyPressed(V)||this.inputManager.isKeyPressed(z),this.shootPressed=this.inputManager.isKeyPressed(F)||this.inputManager.isKeyPressed(Y)||this.inputManager.isKeyPressed(J)}handleMouseInput(){if(this.inputManager.isMouseButtonPressed(t.LEFT)){const e=this.inputManager.getMousePosition(),t=j.WIDTH;e.x<t/3?this.leftPressed=!0:e.x>2*t/3&&(this.rightPressed=!0),this.shootPressed=!0}}handleTouchInput(){const e=this.inputManager.getTouches();if(e.length>0){const t=e[0],s=j.WIDTH;this.isTouching?t.position.x<s/3?this.leftPressed=!0:t.position.x>2*s/3&&(this.rightPressed=!0):(this.isTouching=!0,this.shootPressed=!0)}else this.isTouching=!1}setupTouchEvents(){const e=document.getElementById("game-canvas");e&&(e.addEventListener("touchstart",e=>e.preventDefault()),e.addEventListener("touchmove",e=>e.preventDefault()),e.addEventListener("touchend",e=>e.preventDefault()))}sendInputToPlayer(){this.player&&this.player.setInput(this.leftPressed,this.rightPressed,this.shootPressed),this.resetInputStates()}resetInputStates(){this.inputManager.isKeyPressed(F)||this.inputManager.isKeyPressed(Y)||this.inputManager.isKeyPressed(J)||this.inputManager.isMouseButtonPressed(t.LEFT)||0!==this.inputManager.getTouchCount()||(this.shootPressed=!1),this.inputManager.isKeyPressed(W)||this.inputManager.isKeyPressed(K)||this.inputManager.isMouseButtonPressed(t.LEFT)||0!==this.inputManager.getTouchCount()||(this.leftPressed=!1),this.inputManager.isKeyPressed(V)||this.inputManager.isKeyPressed(z)||this.inputManager.isMouseButtonPressed(t.LEFT)||0!==this.inputManager.getTouchCount()||(this.rightPressed=!1)}render(e){this.drawMobileInputGuide(e)}drawMobileInputGuide(e){"ontouchstart"in window&&(e.save(),e.globalAlpha=.3,e.fillStyle="white",e.font="16px Arial",e.textAlign="center",e.fillText("",166,750),e.fillText("",833,750),e.fillText("TAP TO SHOOT",500,750),e.restore())}}class Se extends M{constructor(e){super(e),this.currentScore=0,this.lastDifficultyScore=0,this.highScore=0,this.baselineY=0,this.scoreLabel=null,this.highScoreLabel=null,this.player=null,this.loadHighScore()}onStart(){this.createScoreUI(),this.currentScore=0,this.lastDifficultyScore=1,localStorage.removeItem(R.CURRENT_SCORE_KEY)}setPlayer(e){this.player=e,this.baselineY=e.getPosition().y}update(e){this.updateScore(),this.updateDifficultyLevel()}static getCurrentDifficultyLevel(){return this.difficultyLevel}updateDifficultyLevel(){this.currentScore-this.lastDifficultyScore>=R.DIFFICULTY&&(Se.difficultyLevel++,L.clamp(Se.difficultyLevel,1,6),this.lastDifficultyScore=this.currentScore)}createScoreUI(){const e=new v({name:"ScoreLabel",position:new _(50,50),tag:"UI",layer:1001});this.scoreLabel=new G(e,"Score: 0"),this.scoreLabel.setCanvas(H.getInstance().getCanvas()),this.scoreLabel.setFont("24px Arial"),this.scoreLabel.setColor(D.WHITE),this.scoreLabel.setAnchor(d.TOP_LEFT),this.scoreLabel.size=new _(200,40),this.scoreLabel.margin={top:20,left:20,bottom:0,right:0},e.addComponent(this.scoreLabel);const t=new v({name:"HighScoreLabel",position:new _(50,100),tag:"UI",layer:1001});this.highScoreLabel=new G(t,`High: ${this.highScore}`),this.highScoreLabel.setCanvas(H.getInstance().getCanvas()),this.highScoreLabel.setFont("24px Arial"),this.highScoreLabel.setColor(D.YELLOW),this.highScoreLabel.setAnchor(d.TOP_LEFT),this.highScoreLabel.size=new _(200,40),this.highScoreLabel.margin={top:20,right:20,bottom:0,left:0},t.addComponent(this.highScoreLabel),H.getInstance().getUIManager().addRootElement(this.scoreLabel),H.getInstance().getUIManager().addRootElement(this.highScoreLabel)}updateScore(){if(!this.player)return;const e=this.player.getPosition().y,t=Math.max(0,Math.floor((this.baselineY-e)/10));t>this.currentScore&&(this.currentScore=t,this.currentScore>this.highScore&&(this.highScore=this.currentScore,this.saveHighScore()))}getCurrentScore(){return this.currentScore}getHighScore(){return this.highScore}resetScore(){this.currentScore=0,this.player&&(this.baselineY=this.player.getPosition().y)}addBonusScore(e){this.currentScore+=e,this.currentScore>this.highScore&&(this.highScore=this.currentScore,this.saveHighScore())}loadHighScore(){try{const e=localStorage.getItem(R.HIGH_SCORE_KEY);this.highScore=e?parseInt(e,10):0}catch(e){console.warn("Could not load high score:",e),this.highScore=0}}saveHighScore(){try{localStorage.setItem(R.HIGH_SCORE_KEY,this.highScore.toString()),localStorage.setItem(R.CURRENT_SCORE_KEY,this.currentScore.toString())}catch(e){console.warn("Could not save high score:",e)}}render(e){}}Se.difficultyLevel=1;class _e extends M{constructor(e,t){super(e),this.isActive=!0,this.obstacleType=t,this.setupCollider(),this.setupRenderer(),this.setupObstacleSpecific()}setupCollider(){const e=this.gameObject.getComponent(de);e&&(e.layers=[n.ENVIRONMENT],e.mask=[n.PLAYER],e.isTrigger=!0,e.addEventListener(g,this.onPlayerCollision.bind(this)),e.addEventListener(g,this.onProjectileCollision.bind(this)))}onPlayerCollision(e){const{other:t}=e.data;"Player"===t.getGameObject().tag&&this.onPlayerHit(t.getGameObject())}onProjectileCollision(e){const{other:t}=e.data;"Projectile"===t.getGameObject().tag&&this.onProjectileHit(t.getGameObject())}onProjectileHit(e){if("landed_spike"===this.gameObject.tag)return;this.deactivate();const t=e.getComponent(Ee);t&&t.deactivate()}onPlayerHit(e){const t=e.getComponent(Te);t&&(t.dispatchEvent(ue,{obstacle:this.gameObject,player:e,obstacleType:this.obstacleType}),H.getInstance().getAudioManager().playSound(R.AUDIO.SFX.HIT))}deactivate(){this.isActive=!1,this.gameObject.setActive(!1);const e=this.gameObject.getComponent(de);e&&H.getInstance()&&H.getInstance().getCollisionManager().removeCollider(e),H.getInstance().getAudioManager().playSound(R.AUDIO.SFX.DESTROY_OBSTACLE);const t=H.getInstance().getCurrentScene();t&&t.removeGameObject(this.gameObject),this.gameObject.destroy()}isObstacleActive(){return this.isActive}getObstacleType(){return this.obstacleType}update(e){this.isActive&&(this.updateObstacle(e),this.checkBounds())}checkBounds(){}render(e){this.isActive&&this.renderEffects(e)}renderEffects(e){}}class Ie extends _e{constructor(e,t="witch"){super(e,`moving_${t}`),this.moveTime=0,this.movingType=t,this.startPosition=new _(e.getPosition().x,e.getPosition().y),this.setupMovementParameters()}setupMovementParameters(){var e;switch(this.movingType){case"witch":this.moveSpeed=R.OBSTACLES.WITCH.MOVE_SPEED,this.moveRange=R.OBSTACLES.WITCH.MOVE_RANGE,this.movePattern=L.randomChoice(["horizontal","zigzag","circular"]);break;case"flying_monster":this.moveSpeed=R.OBSTACLES.FLYING_MONSTER.MOVE_SPEED,this.movePattern=L.randomChoice(["repeat"])}this.moveDirection=this.getInitialDirection(),null===(e=this.gameObject.getComponent(q))||void 0===e||e.setFlip(this.moveDirection.x,1)}getInitialDirection(){switch(this.movePattern){case"horizontal":case"repeat":return new _(L.randomSign(),0);case"vertical":return new _(0,L.randomSign());default:return new _(1,0)}}setupRenderer(){}setupObstacleSpecific(){}updateObstacle(e){this.moveTime+=e/1e3,this.updateMovement(e),this.updateSpecialBehaviors(e)}updateMovement(e){const t=this.gameObject.getComponent(P);if(!t)return;const s=t.getWorldPosition();let i=s.clone();switch(this.movePattern){case"horizontal":i=this.updateHorizontalMovement(s,e);break;case"vertical":i=this.updateVerticalMovement(s,e);break;case"circular":i=this.updateCircularMovement(s,e);break;case"zigzag":i=this.updateZigzagMovement(s,e);break;case"repeat":i=this.updateRepeatMovement(s,e)}t.setPosition(i)}updateHorizontalMovement(e,t){var s;const i=this.moveDirection.x*this.moveSpeed*(t/1e3);let n=e.x+i;return Math.abs(n-this.startPosition.x)>this.moveRange&&(this.moveDirection.x*=-1,null===(s=this.gameObject.getComponent(q))||void 0===s||s.setFlip(this.moveDirection.x,1),n=e.x+this.moveDirection.x*this.moveSpeed*(t/1e3)),new _(n,e.y)}updateRepeatMovement(e,t){const s=this.moveDirection.x*this.moveSpeed*(t/1e3);let i=e.x+s;return i<-j?i=j.WIDTH:i>j.WIDTH&&(i=0),new _(i,e.y)}updateVerticalMovement(e,t){const s=this.moveDirection.y*this.moveSpeed*(t/1e3);let i=e.y+s;return Math.abs(i-this.startPosition.y)>this.moveRange&&(this.moveDirection.y*=-1,i=e.y+this.moveDirection.y*this.moveSpeed*(t/1e3)),new _(e.x,i)}updateCircularMovement(e,t){var s;const i=this.moveRange/2,n=this.moveSpeed/i,a=this.moveTime*n,o=this.startPosition.x+Math.cos(a)*i,r=this.startPosition.y+Math.sin(a)*i*.5;return null===(s=this.gameObject.getComponent(q))||void 0===s||s.setFlip(o>this.gameObject.getPosition().x?1:-1,1),new _(o,r)}updateZigzagMovement(e,t){var s;const i=this.moveSpeed,n=.5*this.moveSpeed,a=this.moveDirection.x*i*(t/1e3);let o=e.x+a;const r=this.startPosition.y+30*Math.sin(3*this.moveTime)*n*(t/1e3);return Math.abs(o-this.startPosition.x)>this.moveRange&&(this.moveDirection.x*=-1,o=e.x+this.moveDirection.x*i*(t/1e3),null===(s=this.gameObject.getComponent(q))||void 0===s||s.setFlip(this.moveDirection.x,1)),new _(o,r)}updateSpecialBehaviors(e){}checkBounds(){const e=this.gameObject.getPosition(),t=_.distance(e,this.startPosition);(e.y>j.HEIGHT+500||t>3*this.moveRange)&&this.deactivate()}getMoveSpeed(){return this.moveSpeed}setMoveSpeed(e){this.moveSpeed=e}}class be extends _e{constructor(e,t){super(e,`static_${t}`),this.staticType=t}setupRenderer(){}setupObstacleSpecific(){}updateObstacle(e){}checkBounds(){}}class Ce{static createStaticObstacle(e,t){const s=new v({name:`${t}_${Date.now()}`,tag:"Item",layer:2,position:e}),n=new q(s),a=new de(s);if("landed_spike"===t){s.tag="landed_spike",n.setImageSize(R.OBSTACLES.LANDED_SPIKE.WIDTH,R.OBSTACLES.LANDED_SPIKE.HEIGHT);const e=H.getInstance().getResourceManager().getResource(R.OBSTACLES.LANDED_SPIKE.ICON);n.setImage(e),a.type=i.BOX,a.setRenderer(n),s.addComponent(n),s.addComponent(a);const o=new be(s,t);s.addComponent(o)}H.getInstance().getCollisionManager().addCollider(a);const o=H.getInstance().getCurrentScene();return o&&o.addGameObject(s),s}static createLandedSpike(e){return this.createStaticObstacle(e,"landed_spike")}static createRandomStaticObstacle(e){const t=[{type:"landed_spike",chance:R.OBSTACLES.LANDED_SPIKE.SPAWN_CHANCE}],s=t.reduce((e,t)=>e+t.chance,0);let i=L.random()*s;for(const s of t){if(i<s.chance)return this.createStaticObstacle(e,s.type);i-=s.chance}return this.createStaticObstacle(e,"landed_spike")}static createMovingObstacle(e,t){const s=new v({name:`${t}_${Date.now()}`,tag:"Item",layer:2,position:e}),n=new q(s),a=new de(s);if("witch"===t){n.setImageSize(R.OBSTACLES.WITCH.WIDTH,R.OBSTACLES.WITCH.HEIGHT);const e=H.getInstance().getResourceManager().getResource(R.OBSTACLES.WITCH.ICON);n.setImage(e),a.type=i.BOX,a.setRenderer(n),s.addComponent(n),s.addComponent(a);const o=new Ie(s,t);s.addComponent(o)}else if("flying_monster"===t){n.setImageSize(R.OBSTACLES.FLYING_MONSTER.WIDTH,R.OBSTACLES.FLYING_MONSTER.HEIGHT);const e=H.getInstance().getResourceManager().getResource(R.OBSTACLES.FLYING_MONSTER.ICON);n.setImage(e),a.type=i.BOX,a.setRenderer(n),s.addComponent(n),s.addComponent(a);const o=new Ie(s,t);s.addComponent(o)}H.getInstance().getCollisionManager().addCollider(a);const o=H.getInstance().getCurrentScene();return o&&o.addGameObject(s),s}static createWitch(e){return this.createMovingObstacle(e,"witch")}static createFlyingMonster(e){return this.createMovingObstacle(e,"flying_monster")}static createRandomMovingObstacle(e){const t=[{type:"witch",chance:R.OBSTACLES.WITCH.SPAWN_CHANCE},{type:"flying_monster",chance:R.OBSTACLES.FLYING_MONSTER.SPAWN_CHANCE}],s=t.reduce((e,t)=>e+t.chance,0);let i=L.random()*s;for(const s of t){if(i<s.chance)return this.createMovingObstacle(e,s.type);i-=s.chance}return this.createMovingObstacle(e,"witch")}static createRandomObstacleByLevel(e){const t=Se.getCurrentDifficultyLevel(),s=[];t>=R.OBSTACLES.LANDED_SPIKE.SPAWN_LEVEL&&s.push({type:"landed_spike",chance:R.OBSTACLES.LANDED_SPIKE.SPAWN_CHANCE,create:e=>this.createLandedSpike(e)}),t>=R.OBSTACLES.FLYING_MONSTER.SPAWN_LEVEL&&s.push({type:"flying_monster",chance:R.OBSTACLES.FLYING_MONSTER.SPAWN_CHANCE,create:e=>this.createFlyingMonster(e)}),t>=R.OBSTACLES.WITCH.SPAWN_LEVEL&&s.push({type:"witch",chance:R.OBSTACLES.WITCH.SPAWN_CHANCE,create:e=>this.createWitch(e)});const i=s.reduce((e,t)=>e+t.chance,0);if(0===i)return this.createLandedSpike(e);let n=L.random()*i;for(const t of s){if(n<t.chance)return t.create(e);n-=t.chance}return this.createLandedSpike(e)}}class we extends M{constructor(e,t){super(e),this.isActive=!0,this.itemType=t,this.spawnTime=Date.now(),this.setupCollider(),this.setupRenderer(),this.setupItemSpecific()}setupCollider(){const e=this.gameObject.getComponent(de);e&&(e.layers=[n.ENVIRONMENT],e.mask=[n.PLAYER],e.isTrigger=!0,e.addEventListener(g,this.onPlayerCollision.bind(this)))}onPlayerCollision(e){const{other:t}=e.data;console.log("Player collided with item:",this.itemType),"Player"===t.getGameObject().tag&&this.onPlayerHit(t.getGameObject())}onPlayerHit(e){"trampoline"!==this.itemType&&this.deactivate()}deactivate(){this.isActive=!1,this.gameObject.setActive(!1);const e=this.gameObject.getComponent(de);e&&H.getInstance()&&H.getInstance().getCollisionManager().removeCollider(e);const t=H.getInstance().getCurrentScene();t&&t.removeGameObject(this.gameObject),this.gameObject.destroy()}update(e){this.isActive&&(this.updateItem(e),this.checkBounds())}checkBounds(){}render(e){this.isActive&&this.renderEffects(e)}renderEffects(e){}}class Me extends we{updateItem(e){}constructor(e){super(e,"trampoline")}setupRenderer(){}setupItemSpecific(){}onPlayerHit(e){super.onPlayerHit(e);const t=e.getComponent(ne);if(t){const e=t.velocity.clone();e.y=-R.ITEMS.TRAMPOLINE.BOUNCE_FORCE,t.setVelocity(e),H.getInstance().getAudioManager().playSound(R.AUDIO.SFX.TRAMPOLINE,!1)}}}class Pe extends we{updateItem(e){}constructor(e){super(e,"jetpack")}setupRenderer(){}setupItemSpecific(){}onPlayerHit(e){super.onPlayerHit(e);const t=e.getComponent(Te);t&&(t.setUsingJetpack(!0),H.getInstance().getAudioManager().playSound(R.AUDIO.SFX.JETPACK))}}class ve{static createItems(e,t){const s=new v({name:`${t}_${Date.now()}`,tag:"Item",layer:2,position:e}),n=new q(s),a=new de(s);if("trampoline"===t){n.setImageSize(R.ITEMS.TRAMPOLINE.WIDTH,R.ITEMS.TRAMPOLINE.HEIGHT);const e=H.getInstance().getResourceManager().getResource(R.ITEMS.TRAMPOLINE.ICON);n.setImage(e),a.type=i.BOX,a.setRenderer(n),s.addComponent(n),s.addComponent(a);const t=new Me(s);s.addComponent(t)}else if("jetpack"===t){n.setImageSize(R.ITEMS.JETPACK.WIDTH,R.ITEMS.JETPACK.HEIGHT);const e=H.getInstance().getResourceManager().getResource(R.ITEMS.JETPACK.ICON);n.setImage(e),a.type=i.BOX,a.setRenderer(n),s.addComponent(n),s.addComponent(a);const t=new Pe(s);s.addComponent(t)}H.getInstance().getCollisionManager().addCollider(a);const o=H.getInstance().getCurrentScene();return o&&o.addGameObject(s),s}static createTrampoline(e){return this.createItems(e,"trampoline")}static createJetpack(e){return this.createItems(e,"jetpack")}static createRandomItem(e){const t=[{type:"trampoline",chance:R.ITEMS.TRAMPOLINE.SPAWN_CHANCE},{type:"jetpack",chance:R.ITEMS.JETPACK.SPAWN_CHANCE}],s=t.reduce((e,t)=>e+t.chance,0);let i=L.random()*s;for(const s of t){if(i<s.chance)return this.createItems(e,s.type);i-=s.chance}return this.createItems(e,"trampoline")}}class Re extends me{constructor(e){super(e),this.moveSpeed=50,this.moveDirection=L.randomSign(),this.transform=this.gameObject.getComponent(P),this.setPlatformType("moving")}update(e){if(super.update(e),this.transform){const t=this.transform.getWorldPosition(),s=t.x+this.moveDirection*this.moveSpeed*(e/1e3)*Se.getCurrentDifficultyLevel();(s<50||s>j.WIDTH-50)&&(this.moveDirection*=-1),this.transform.setPosition(new _(Math.max(50,Math.min(j.WIDTH-50,s)),t.y))}}}class Le extends M{constructor(e,t){super(e),this.platformsImg=[],this.platforms=[],this.lastPlatformX=j.WIDTH/2,this.MAX_PLATFORM_X_DIFF=j.WIDTH/2,this.spawnDistance=R.PLATFORM.SPAWN_DISTANCE,this.scene=t}onStart(){this.gameEngine=H.getInstance(),this.generateGround(),this.loadPlatformImages(),this.generateInitialPlatforms()}update(e){this.generateNewPlatforms(),this.removeOldPlatforms(),this.increateSpawnDistance()}increateSpawnDistance(){this.spawnDistance=R.PLATFORM.SPAWN_DISTANCE*(.25*(Se.getCurrentDifficultyLevel()-1)+1),this.spawnDistance>R.PLATFORM.MAX_SPAWN_DISTANCE&&(this.spawnDistance=R.PLATFORM.MAX_SPAWN_DISTANCE)}loadPlatformImages(){for(const e of Object.keys(R.IMAGES.PLATFORMS))this.platformsImg.push(this.gameEngine.getResourceManager().getResource(R.IMAGES.PLATFORMS[e]))}generateGround(){const e=new v({name:"Ground",tag:"Ground",layer:2,position:new _(j.WIDTH/2,j.HEIGHT)}),t=new q(e),s=this.gameEngine.getResourceManager().getResource(R.IMAGES.GROUND);s?t.setImage(s):console.warn("Ground image resource not found"),t.setImageSize(j.WIDTH+64,156),e.addComponent(t);const a=new de(e);a.setRenderer(t),a.setColliderType(i.POLYGON),a.layers=[n.GROUND],a.mask=[n.PLAYER],e.addComponent(a),this.platforms.push(new me(e)),this.scene.addGameObject(e),this.gameEngine.getCollisionManager().addCollider(a)}generateInitialPlatforms(){for(let e=1;e<R.PLATFORM.INITIAL_COUNT;e++){const t=j.HEIGHT-32-e*R.PLATFORM.SPAWN_DISTANCE;this.createPlatformWithConstraint(t,!1)}}createPlatformWithConstraint(e,t=!0){const s=Math.max(R.PLATFORM.WIDTH/2,this.lastPlatformX-this.MAX_PLATFORM_X_DIFF),i=Math.min(j.WIDTH-R.PLATFORM.WIDTH/2,this.lastPlatformX+this.MAX_PLATFORM_X_DIFF),n=L.random(s,i);return this.lastPlatformX=n,this.createPlatform(new _(n,e),t)}createPlatform(e,t=!0){const s=new v({name:"Platform",tag:"Platform",layer:2,position:e}),a=new q(s),o=this.platformsImg[L.randomInt(0,this.platformsImg.length-1)];a.setImage(o),a.setImageSize(R.PLATFORM.WIDTH,R.PLATFORM.HEIGHT),a.setColor(D.WHITE),s.addComponent(a);const r=new de(s);r.setRenderer(a),r.setColliderSize(a.getWidth()-12,a.getHeight()),r.setColliderType(i.POLYGON),r.layers=[n.GROUND],r.mask=[n.PLAYER],s.addComponent(r);let h=new me(s);const l=L.random(0,1);return l<R.MOVING_PLATFORM_SPAWN_CHANCE?h=new Re(s):l<R.BREAKABLE_PLATFORM_SPAWN_CHANCE+R.MOVING_PLATFORM_SPAWN_CHANCE&&(h=new pe(s)),s.addComponent(h),this.scene.addGameObject(s),this.platforms.push(h),t&&"normal"===h.getPlatformType()&&this.maybeAddObjectOnPlatform(s),this.gameEngine.getCollisionManager().addCollider(r),s}maybeAddObjectOnPlatform(e){var t,s,i,n,a,o;const r=e.getComponent(me);if(null===r)return;if(r.containsObject())return;const h=Se.getCurrentDifficultyLevel(),l=Math.min(.1+.05*h,.4),c=L.random(0,1),d=e.getPosition().add(new _(0,-R.PLATFORM.HEIGHT/2));if(c<l){const e=Ce.createRandomObstacleByLevel(d);return this.scene.addGameObject(e),null===(t=r.updateObjectStatus)||void 0===t||t.call(r,!0),void(null===(s=r.setObject)||void 0===s||s.call(r,e))}if(c<l+.1){const e=ve.createRandomItem(d.add(new _(0,-24)));return this.scene.addGameObject(e),null===(i=r.updateObjectStatus)||void 0===i||i.call(r,!0),void(null===(n=r.setObject)||void 0===n||n.call(r,e))}if(c<l+.1+.25){const t=this.createDecorationOnPlatform(e);t&&(this.scene.addGameObject(t),null===(a=r.updateObjectStatus)||void 0===a||a.call(r,!0),null===(o=r.setObject)||void 0===o||o.call(r,t))}}createDecorationOnPlatform(e){const t=Object.keys(R.IMAGES.DECORATIONS),s=L.randomChoice(t),i=e.getPosition().add(new _(L.random(-30,30),-R.PLATFORM.HEIGHT/2-R.DECORATION.HEIGHT/2+12)),n=new v({name:`Deco_${s}`,tag:"Decoration",layer:2,position:i}),a=new q(n),o=this.gameEngine.getResourceManager().getResource(R.IMAGES.DECORATIONS[s]);return a.setImage(o),a.setImageSize(R.DECORATION.WIDTH,R.DECORATION.HEIGHT),n.addComponent(a),n}generateNewPlatforms(){let e=Number.POSITIVE_INFINITY;for(const t of this.platforms){const s=t.getGameObject().getPosition().y;s<e&&(e=s)}const t=this.scene.getMainCamera();if(!t)return;const s=t.getGameObject().getPosition().y-j.HEIGHT/2-200;for(;e>s;)e-=this.spawnDistance,this.createPlatformWithConstraint(e)}removeOldPlatforms(){const e=this.scene.getMainCamera();if(!e)return;const t=e.getGameObject().getPosition().y;this.platforms=this.platforms.filter(e=>{if(e.getGameObject().getPosition().y-t>j.HEIGHT/2+R.PLATFORM.HEIGHT){if(e.containsObject()){const t=e.getObject();t&&(this.scene.removeGameObject(t),t.destroy())}return this.scene.removeGameObject(e.getGameObject()),e.getGameObject().destroy(),!1}return!0})}render(e){}}class De extends M{constructor(e){super(e),this.isPaused=!1,this.isSoundOn=!1}onAwake(){this.gameEngine=H.getInstance(),this.createAnimator(),this.createPauseButton(),this.createSoundToggleButton(),this.createPauseMenu(),this.addUIToManager()}createAnimator(){var e;const t=new v({name:"PauseAnimator"});this.animator=new ae(t),t.addComponent(this.animator),null===(e=this.gameEngine.getCurrentScene())||void 0===e||e.addGameObject(t)}createPauseButton(){const e=new v({name:"PauseButton",position:new _(-96,48)});this.pauseButton=new te(e,"");const t=H.getInstance().getResourceManager().getResource(R.IMAGES.BUTTON.SETTINGS_BUTTON);this.pauseButton.setBackgroundImage(t),this.pauseButton.setAnchor(d.TOP_RIGHT),this.pauseButton.size=new _(64,64),this.pauseButton.toggleParticleSystem(!1),this.pauseButton.setOnClick(()=>this.pauseGame()),e.addComponent(this.pauseButton)}createSoundToggleButton(){const e=new v({name:"SoundToggleButton",position:new _(-96,128)});this.soundToggleButton=new te(e,"");const t=H.getInstance().getResourceManager().getResource(R.IMAGES.BUTTON.SOUND_ON_BUTTON),s=H.getInstance().getResourceManager().getResource(R.IMAGES.BUTTON.SOUND_OFF_BUTTON);this.isSoundOn="true"===localStorage.getItem(R.AUDIO_ENABLED_KEY),this.soundToggleButton.setBackgroundImage(this.isSoundOn?t:s),this.soundToggleButton.setAnchor(d.TOP_RIGHT),this.soundToggleButton.size=new _(64,64),this.soundToggleButton.toggleParticleSystem(!1),this.soundToggleButton.setOnClick(()=>this.toggleSound()),e.addComponent(this.soundToggleButton)}createPauseMenu(){const e=new v({name:"PauseOverlay",position:new _(0,0)});this.pauseOverlay=new ie(e),this.pauseOverlay.setAnchor(d.TOP_LEFT),this.pauseOverlay.size=new _(j.WIDTH,j.HEIGHT),this.pauseOverlay.setGradient([new D(0,0,0,.7),new D(0,0,0,.7)]),this.pauseOverlay.cornerRadius=0,this.pauseOverlay.borderWidth=0,this.pauseOverlay.setVisible(!1),e.addComponent(this.pauseOverlay);const t=new v({name:"PauseMenu",position:new _(-100,-300)});this.pauseMenu=new ie(t),this.pauseMenu.setAnchor(d.MIDDLE_CENTER),this.pauseMenu.size=new _(400,600),this.pauseMenu.setGradient([new D(0,0,0,0),new D(0,0,0,0)]),this.pauseMenu.cornerRadius=0,this.pauseMenu.borderWidth=0;const s=H.getInstance().getResourceManager().getResource(R.IMAGES.BACKGROUND.PAUSE_PANEL_BACKGROUND);this.pauseMenu.setBackgroundImage(s,"cover"),t.addComponent(this.pauseMenu),this.pauseOverlay.addChild(this.pauseMenu);const i=new v({name:"ResumeButton",position:new _(-32,48)});this.resumeButton=new te(i,"");const n=H.getInstance().getResourceManager().getResource(R.IMAGES.BUTTON.RESUME_BUTTON);this.resumeButton.setBackgroundImage(n),this.resumeButton.setAnchor(d.MIDDLE_CENTER),this.resumeButton.size=new _(64,64),this.resumeButton.toggleParticleSystem(!1),this.resumeButton.setOnClick(()=>this.resumeGame()),i.addComponent(this.resumeButton),this.pauseMenu.addChild(this.resumeButton);const a=new v({name:"RestartButton",position:new _(-32,128)});this.restartButton=new te(a,"");const o=H.getInstance().getResourceManager().getResource(R.IMAGES.BUTTON.RESTART_BUTTON);this.restartButton.setBackgroundImage(o),this.restartButton.setAnchor(d.MIDDLE_CENTER),this.restartButton.size=new _(64,64),this.restartButton.toggleParticleSystem(!1),this.restartButton.setOnClick(()=>this.restartGame()),a.addComponent(this.restartButton),this.pauseMenu.addChild(this.restartButton);const r=new v({name:"HomeButton",position:new _(-32,208)});this.homeButton=new te(r,"");const h=H.getInstance().getResourceManager().getResource(R.IMAGES.BUTTON.BACK_BUTTON);this.homeButton.setBackgroundImage(h),this.homeButton.setAnchor(d.MIDDLE_CENTER),this.homeButton.size=new _(64,64),this.homeButton.toggleParticleSystem(!1),this.homeButton.setOnClick(()=>this.goToMainMenu()),r.addComponent(this.homeButton),this.pauseMenu.addChild(this.homeButton)}addUIToManager(){const e=this.gameEngine.getUIManager();e&&(e.addRootElement(this.pauseButton),e.addRootElement(this.soundToggleButton),e.addRootElement(this.pauseOverlay))}toggleSound(){this.isSoundOn=!this.isSoundOn,localStorage.setItem(R.AUDIO_ENABLED_KEY,String(this.isSoundOn));const e=this.gameEngine.getResourceManager().getResource(R.IMAGES.BUTTON.SOUND_ON_BUTTON),t=this.gameEngine.getResourceManager().getResource(R.IMAGES.BUTTON.SOUND_OFF_BUTTON);this.soundToggleButton.setBackgroundImage(this.isSoundOn?e:t),this.gameEngine.getAudioManager().setEnabled(this.isSoundOn)}pauseGame(){this.isPaused||(this.isPaused=!0,this.pauseOverlay.setVisible(!0),this.animator.animate(this.pauseOverlay,{type:E.FadeIn,duration:600}),this.animator.animate(this.pauseMenu,{type:E.SLIDE_IN_FROM_TOP,duration:600,onComplete:()=>{this.gameEngine.pause(),this.pauseMenu.setLocalPosition(new _(-100,-300))}}))}resumeGame(){this.isPaused&&(this.gameEngine.resume(),this.isPaused=!1,this.onResumeCallback&&this.onResumeCallback(),this.animator.animate(this.pauseMenu,{type:E.SLIDE_OUT_TO_TOP,duration:600,onComplete:()=>{this.pauseMenu.setLocalPosition(new _(-100,-300))}}),this.animator.animate(this.pauseOverlay,{type:E.FADE_OUT,duration:600,onComplete:()=>{this.pauseOverlay.setVisible(!1)}}))}restartGame(){this.resumeGame(),setTimeout(()=>{this.onRestartCallback&&this.onRestartCallback()},300)}goToMainMenu(){this.resumeGame(),setTimeout(()=>{this.onMenuCallback&&this.onMenuCallback()},300)}isPauseActive(){return this.isPaused}setOnResume(e){this.onResumeCallback=e}setOnMenu(e){this.onMenuCallback=e}setOnRestart(e){this.onRestartCallback=e}getPauseOverlay(){return this.pauseOverlay}getPauseMenu(){return this.pauseMenu}getPauseButton(){return this.pauseButton}getSoundToggleButton(){return this.soundToggleButton}update(e){this.isPaused&&this.animator&&this.animator.update(e)}render(e){}}class Ne extends he{constructor(e="GameplayScene"){super(e),this.gameState=h.PLAYING,this.isGameOver=!1}onLoad(){console.log("Loading Gameplay Scene..."),this.gameEngine=H.getInstance(),this.gameState=h.PLAYING,this.isGameOver=!1,this.createCamera(),this.createPlayer(),this.createPlatformManager(),this.createBackgroundManager(),this.createScoreManager(),this.createInputManager(),this.createPauseManager(),this.setupSystemConnections(),console.log("Gameplay Scene loaded successfully!")}onUnload(){console.log("Unloading Gameplay Scene...");const e=this.gameEngine.getUIManager();e&&this.pauseManager&&(e.removeRootElement(this.pauseManager.getPauseOverlay()),e.removeRootElement(this.pauseManager.getSoundToggleButton()),e.removeRootElement(this.pauseManager.getPauseButton()))}createCamera(){this.camera=new v({name:"MainCamera",position:new _(j.WIDTH/2,j.HEIGHT/2)});const e=new ye(this.camera);this.camera.addComponent(e),this.addGameObject(this.camera),this.mainCamera=e}createPlayer(){this.player=new v({name:"Player",tag:"Player",layer:1e3,position:new _(j.WIDTH/2,j.HEIGHT-120)});const e=new ne(this.player);e.mass=1,e.drag=.98,e.useGravity=!0,e.setVelocity(new _(0,0)),this.player.addComponent(e);const t=new Q(this.player);t.addAnimation(R.ANIMATIONS.PLAYER_IDLE.Name,R.ANIMATIONS.PLAYER_IDLE.Frames,this.gameEngine,R.ANIMATIONS.PLAYER_IDLE.FrameRate,R.ANIMATIONS.PLAYER_IDLE.Loop),t.addAnimation(R.ANIMATIONS.PLAYER_IDLE_JETPACK.Name,R.ANIMATIONS.PLAYER_IDLE_JETPACK.Frames,this.gameEngine,R.ANIMATIONS.PLAYER_IDLE_JETPACK.FrameRate,R.ANIMATIONS.PLAYER_IDLE_JETPACK.Loop),t.addAnimation(R.ANIMATIONS.PLAYER_MOVE_LEFT.Name,R.ANIMATIONS.PLAYER_MOVE_LEFT.Frames,this.gameEngine,R.ANIMATIONS.PLAYER_MOVE_LEFT.FrameRate,R.ANIMATIONS.PLAYER_MOVE_LEFT.Loop),t.addAnimation(R.ANIMATIONS.PLAYER_MOVE_LEFT_JETPACK.Name,R.ANIMATIONS.PLAYER_MOVE_LEFT_JETPACK.Frames,this.gameEngine,R.ANIMATIONS.PLAYER_MOVE_LEFT_JETPACK.FrameRate,R.ANIMATIONS.PLAYER_MOVE_LEFT_JETPACK.Loop),t.addAnimation(R.ANIMATIONS.PLAYER_MOVE_RIGHT.Name,R.ANIMATIONS.PLAYER_MOVE_RIGHT.Frames,this.gameEngine,R.ANIMATIONS.PLAYER_MOVE_RIGHT.FrameRate,R.ANIMATIONS.PLAYER_MOVE_RIGHT.Loop),t.addAnimation(R.ANIMATIONS.PLAYER_MOVE_RIGHT_JETPACK.Name,R.ANIMATIONS.PLAYER_MOVE_RIGHT_JETPACK.Frames,this.gameEngine,R.ANIMATIONS.PLAYER_MOVE_RIGHT_JETPACK.FrameRate,R.ANIMATIONS.PLAYER_MOVE_RIGHT_JETPACK.Loop),t.addAnimation(R.ANIMATIONS.PLAYER_JUMP.Name,R.ANIMATIONS.PLAYER_JUMP.Frames,this.gameEngine,R.ANIMATIONS.PLAYER_JUMP.FrameRate,R.ANIMATIONS.PLAYER_JUMP.Loop),t.addAnimation(R.ANIMATIONS.PLAYER_DEAD.Name,R.ANIMATIONS.PLAYER_DEAD.Frames,this.gameEngine,R.ANIMATIONS.PLAYER_DEAD.FrameRate,R.ANIMATIONS.PLAYER_DEAD.Loop),t.playAnimation(R.ANIMATIONS.PLAYER_IDLE.Name),this.player.addComponent(t);const s=new de(this.player);s.layers=[n.PLAYER],s.mask=[n.GROUND,n.ENVIRONMENT],this.player.addComponent(s);const i=new Te(this.player);this.playerComponent=i,this.player.addComponent(i),i.addEventListener(ue,this.onPlayerHitObstacle.bind(this)),this.addGameObject(this.player)}createPlatformManager(){const e=new v({name:"PlatformManager"});this.platformManager=new Le(e,this),e.addComponent(this.platformManager),this.addGameObject(e)}createBackgroundManager(){const e=new v({name:"BackgroundManager"});this.backgroundManager=new Oe(e,this),e.addComponent(this.backgroundManager),this.addGameObject(e)}createScoreManager(){const e=new v({name:"ScoreManager"});this.scoreManager=new Se(e),e.addComponent(this.scoreManager),this.addGameObject(e)}createInputManager(){const e=new v({name:"InputManager"});this.inputManager=new fe(e,this.gameEngine.getInputManager()),e.addComponent(this.inputManager),this.addGameObject(e)}createPauseManager(){const e=new v({name:"PauseManager"});this.pauseManager=new De(e),this.pauseManager.setOnResume(()=>{this.gameState=h.PLAYING,this.isGameOver=!1}),this.pauseManager.setOnMenu(()=>{this.gameEngine.setScene("MainMenuScene")}),this.pauseManager.setOnRestart(()=>{this.restartGame()}),e.addComponent(this.pauseManager),this.addGameObject(e)}setupSystemConnections(){const e=this.camera.getComponent(ye);e&&e.setTarget(this.player),this.backgroundManager&&this.mainCamera&&this.backgroundManager.setCamera(this.mainCamera),this.scoreManager&&this.scoreManager.setPlayer(this.player);const t=this.player.getComponent(Te);this.inputManager&&t&&this.inputManager.setPlayer(t)}onPlayerFell(e){this.triggerGameOver()}onPlayerHitObstacle(e){this.gameState===h.GAMEOVER||this.isGameOver||(this.gameState=h.GAMEOVER,this.triggerGameOver())}checkGameOver(){if(this.gameState===h.GAMEOVER)return;const e=this.player.getComponent(P);if(!e)return;const t=e.getWorldPosition(),s=this.getMainCamera();if(!s)return;const i=s.getGameObject().getPosition().y;return t.y>i+j.HEIGHT/2?(this.playerComponent.setPlayerDead(!0),void this.triggerGameOver()):void 0}triggerGameOver(){if(this.isGameOver)return;this.isGameOver=!0;const e=this.scoreManager.getCurrentScore(),t=this.scoreManager.getHighScore();localStorage.setItem(R.HIGH_SCORE_KEY,t.toString()),localStorage.setItem(R.CURRENT_SCORE_KEY,e.toString()),console.log(`Game Over! Score: ${e}, High Score: ${t}`),setTimeout(()=>{this.gameEngine.setScene("GameOverScene")},2e3)}onUpdate(e){this.gameEngine.getInputManager().isKeyJustPressed("KeyR")&&this.isGameOver&&this.restartGame(),this.checkGameOver()}onRender(e){this.backgroundManager&&this.backgroundManager.render(e),e.save(),e.font="24px Arial",e.fillStyle="#fff",e.textAlign="left",e.fillText(`Score: ${this.scoreManager.getCurrentScore()}`,100,300),e.restore()}restartGame(){console.log("Restarting game..."),this.gameEngine.setScene("GameplayScene")}getScore(){return this.scoreManager?this.scoreManager.getCurrentScore():0}getHighScore(){return this.scoreManager?this.scoreManager.getHighScore():0}}var Ge,Be,xe=function(e,t,s,i){return new(s||(s=Promise))(function(n,a){function o(e){try{h(i.next(e))}catch(e){a(e)}}function r(e){try{h(i.throw(e))}catch(e){a(e)}}function h(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,r)}h((i=i.apply(e,t||[])).next())})};class ke extends he{constructor(e="MainMenuScene"){super(e),this.isSoundOn="true"===localStorage.getItem(R.AUDIO_ENABLED_KEY),this.introAnimationComplete=!1,this.backgroundAnimationTime=0}onLoad(){return xe(this,void 0,void 0,function*(){console.log("Loading Main Menu Scene..."),this.gameEngine=H.getInstance(),this.gameEngine.getAudioManager().playBackgroundMusic(R.AUDIO.MUSIC.BACKGROUND_MUSIC,{loop:!0,volume:.5}),yield this.createBackground(),yield this.createEffectSystems(),yield this.createUI(),yield this.playIntroAnimation(),console.log("Main Menu Scene loaded successfully!")})}onUnload(){return xe(this,void 0,void 0,function*(){console.log("Unloading Main Menu Scene...");const e=this.gameEngine.getUIManager();e&&this.backgroundPanel&&e.removeRootElement(this.backgroundPanel)})}createBackground(){return xe(this,void 0,void 0,function*(){const e=new v({name:"MenuBackground"});this.addGameObject(e)})}createEffectSystems(){return xe(this,void 0,void 0,function*(){const e=new v({name:"UIAnimator"});this.animator=new ae(e),e.addComponent(this.animator),this.addGameObject(e);const t=new v({name:"MenuParticles"});this.particleSystem=new ee(t,200),t.addComponent(this.particleSystem),this.addGameObject(t)})}createUI(){return xe(this,void 0,void 0,function*(){yield this.createBackgroundPanel(),yield this.createTitle(),yield this.createSubtitle(),yield this.createHighScoreDisplay(),yield this.createPlayButton(),yield this.createInstructions(),yield this.createSoundToggleButton(),this.addUIToManager()})}createBackgroundPanel(){return xe(this,void 0,void 0,function*(){const e=new v({name:"MenuBackgroundPanel",position:new _(-j.WIDTH/2,-j.HEIGHT/2),layer:-1e3});this.backgroundPanel=new ie(e),this.backgroundPanel.setAnchor(d.MIDDLE_CENTER),this.backgroundPanel.size=new _(j.WIDTH,j.HEIGHT),this.backgroundPanel.backgroundColor=new D(0,0,0,0),this.backgroundPanel.cornerRadius=0,this.backgroundPanel.borderWidth=0,this.backgroundPanel.setGradient([new D(0,0,0,0),new D(0,0,0,0),new D(0,0,0,0)]);const t=new v({name:"BackgroundRenderer",position:new _(j.WIDTH/2,j.HEIGHT/2-50),layer:0}),s=t.addComponent(new q(t));s.setColor(new D(255,255,255,.1));const i=this.gameEngine.getResourceManager().getResource(R.IMAGES.BACKGROUND.MAINMENU_BACKGROUND);s.setImage(i),s.setImageSize(.75*j.WIDTH,.75*j.HEIGHT),e.addComponent(this.backgroundPanel),this.addGameObject(t),this.addGameObject(e)})}createTitle(){return xe(this,void 0,void 0,function*(){const e=new v({name:"GameTitle",position:new _(-300,128),layer:10});this.titleLabel=new se(e,"DOODLE JUMP"),this.titleLabel.setAnchor(d.TOP_CENTER),this.titleLabel.setFont('48px "Arial Black", Arial'),this.titleLabel.setColor(D.BLACK),this.titleLabel.setTextAlign("center"),this.titleLabel.size=new _(600,80),this.titleLabel.enableGlow(!0),this.titleLabel.enablePulse(!0),e.setActive(!1),e.addComponent(this.titleLabel),this.backgroundPanel.addChild(this.titleLabel)})}createSubtitle(){return xe(this,void 0,void 0,function*(){const e=new v({name:"GameSubtitle",position:new _(-200,225)});this.subtitleLabel=new se(e,"Jump to the Sky!"),this.subtitleLabel.setAnchor(d.TOP_CENTER),this.subtitleLabel.setFont("24px Arial"),this.subtitleLabel.setColor(new D(200,200,200,.9)),this.subtitleLabel.setTextAlign("center"),this.subtitleLabel.size=new _(400,40),e.addComponent(this.subtitleLabel),e.setActive(!1),this.backgroundPanel.addChild(this.subtitleLabel)})}createHighScoreDisplay(){return xe(this,void 0,void 0,function*(){const e=this.getHighScore(),t=new v({name:"HighScoreDisplay",position:new _(-150,280)});this.highScoreLabel=new se(t,` High Score: ${e}`),this.highScoreLabel.setAnchor(d.TOP_CENTER),this.highScoreLabel.setFont("20px Arial"),this.highScoreLabel.setColor(new D(255,215,0,1)),this.highScoreLabel.setTextAlign("center"),this.highScoreLabel.size=new _(300,30),this.highScoreLabel.enableGlow(!0),t.addComponent(this.highScoreLabel),t.setActive(!1),this.backgroundPanel.addChild(this.highScoreLabel)})}createPlayButton(){return xe(this,void 0,void 0,function*(){const e=new v({name:"PlayButton",position:new _(-105,0)});this.playButton=new te(e,"PLAY GAME"),this.playButton.setAnchor(d.MIDDLE_CENTER),this.playButton.size=new _(210,64),this.playButton.setColors(new D(50,200,50,1),new D(255,255,255,1),new D(80,230,80,1)),this.playButton.enableHoverEffect=!0,this.playButton.enableClickEffect=!0,this.playButton.enableGlow=!0,this.playButton.enablePulse=!0,this.playButton.cornerRadius=15,this.playButton.borderWidth=3,this.playButton.borderColor=new D(255,255,255,.5),this.playButton.label&&this.playButton.label.setFont('24px "Arial Black", Arial'),this.playButton.setOnClick(()=>this.onPlayButtonClick()),e.addComponent(this.playButton),e.setActive(!1),this.backgroundPanel.addChild(this.playButton)})}createInstructions(){return xe(this,void 0,void 0,function*(){const e=new v({name:"Instructions",position:new _(-300,300)});this.instructionsLabel=new se(e," Controls:   or A D to move   or W to shoot"),this.instructionsLabel.setAnchor(d.MIDDLE_CENTER),this.instructionsLabel.setFont("16px Arial"),this.instructionsLabel.setColor(new D(180,180,255,.8)),this.instructionsLabel.setTextAlign("center"),this.instructionsLabel.size=new _(600,40),e.addComponent(this.instructionsLabel),e.setActive(!1),this.backgroundPanel.addChild(this.instructionsLabel)})}createSoundToggleButton(){return xe(this,void 0,void 0,function*(){const e=new v({name:"SoundToggleButton",position:new _(300,75)});this.soundToggleButton=new te(e,""),this.soundToggleButton.setAnchor(d.TOP_CENTER),this.soundToggleButton.size=new _(48,48),this.soundToggleButton.setColors(new D(220,220,220,1),new D(255,255,255,1),new D(180,180,180,1));const t=this.gameEngine.getResourceManager().getResource(R.IMAGES.BUTTON.SOUND_ON_BUTTON),s=this.gameEngine.getResourceManager().getResource(R.IMAGES.BUTTON.SOUND_OFF_BUTTON);this.gameEngine.getAudioManager().setEnabled(this.isSoundOn),this.soundToggleButton.setBackgroundImage(this.isSoundOn?t:s),this.soundToggleButton.cornerRadius=12,this.soundToggleButton.borderWidth=2,this.soundToggleButton.borderColor=new D(100,100,100,.4),this.soundToggleButton.setOnClick(()=>this.toggleSound()),e.addComponent(this.soundToggleButton),e.setActive(!0),this.backgroundPanel.addChild(this.soundToggleButton)})}toggleSound(){this.isSoundOn=!this.isSoundOn,localStorage.setItem(R.AUDIO_ENABLED_KEY,String(this.isSoundOn));const e=this.gameEngine.getResourceManager().getResource(R.IMAGES.BUTTON.SOUND_ON_BUTTON),t=this.gameEngine.getResourceManager().getResource(R.IMAGES.BUTTON.SOUND_OFF_BUTTON);this.soundToggleButton.setBackgroundImage(this.isSoundOn?e:t),this.gameEngine.getAudioManager().setEnabled(this.isSoundOn)}addUIToManager(){const e=this.gameEngine.getUIManager();e&&this.backgroundPanel&&e.addRootElement(this.backgroundPanel)}playIntroAnimation(){return xe(this,void 0,void 0,function*(){this.animator.animate(this.backgroundPanel,{type:E.FadeIn,duration:1e3,easing:re.easeOutCubic}),setTimeout(()=>{this.titleLabel.getGameObject().setActive(!0),this.animator.animate(this.titleLabel,{type:E.SLIDE_IN_FROM_TOP,duration:800,easing:re.easeOutBounce})},200),setTimeout(()=>{this.subtitleLabel.getGameObject().setActive(!0),this.subtitleLabel.startTypewriter(30)},1e3),setTimeout(()=>{this.highScoreLabel.getGameObject().setActive(!0),this.animator.animate(this.highScoreLabel,{type:E.SLIDE_IN_FROM_LEFT,duration:600,easing:re.easeOutQuad})},1200),setTimeout(()=>{this.playButton.getGameObject().setActive(!0),this.animator.animate(this.playButton,{type:E.BOUNCE,duration:500,easing:re.easeOutElastic,onComplete:()=>{this.introAnimationComplete=!0,this.startContinuousEffects()}})},1500),setTimeout(()=>{this.instructionsLabel.getGameObject().setActive(!0),this.instructionsLabel.startTypewriter(50)},1800)})}startContinuousEffects(){setInterval(()=>{const e=Math.random()*j.WIDTH,t=Math.random()*j.HEIGHT;this.particleSystem.emitStars(new _(e,t),1)},500),setInterval(()=>{const e=this.titleLabel.getWorldBounds(),t=e.x+Math.random()*e.width,s=e.y+Math.random()*e.height;this.particleSystem.emitSparkles(new _(t,s),3)},1e3)}onPlayButtonClick(){if(console.log("Starting game from menu..."),this.playButton&&this.particleSystem){const e=this.playButton.getWorldBounds(),t=new _(e.x+e.width/2,e.y+e.height/2);this.particleSystem.emitConfetti(t,30)}setTimeout(()=>{this.gameEngine.setScene("GameplayScene")},300)}getHighScore(){try{const e=localStorage.getItem(R.HIGH_SCORE_KEY);return e?parseInt(e,10):0}catch(e){return 0}}onUpdate(e){this.backgroundAnimationTime+=e}onRender(e){this.renderAnimatedBackground(e),this.particleSystem&&this.particleSystem.render(e),this.drawDecorations(e)}renderAnimatedBackground(e){const t=.001*this.backgroundAnimationTime,s=20*t%360,i=(30*t+180)%360,n=e.createLinearGradient(0,0,0,j.HEIGHT);n.addColorStop(0,D.fromHSL({h:s,s:60,l:20}).toString()),n.addColorStop(.5,D.fromHSL({h:i,s:40,l:15}).toString()),n.addColorStop(1,D.fromHSL({h:s+60,s:50,l:10}).toString()),e.fillStyle=n,e.fillRect(0,0,j.WIDTH,j.HEIGHT)}drawDecorations(e){this.introAnimationComplete&&(e.save(),this.drawFloatingShapes(e),this.drawCornerDecorations(e),this.drawMobileHint(e),e.restore())}drawFloatingShapes(e){const t=5e-4*this.backgroundAnimationTime;for(let s=0;s<8;s++){const i=t+s*Math.PI/4,n=200+50*Math.sin(t+s),a=j.WIDTH/2+Math.cos(i)*n,o=j.HEIGHT/2+Math.sin(i)*n,r=3+2*Math.sin(2*t+s);e.fillStyle=`hsla(${(100*t+45*s)%360}, 70%, 60%, 0.3)`,e.beginPath(),e.arc(a,o,r,0,2*Math.PI),e.fill()}}drawCornerDecorations(e){const t=.002*this.backgroundAnimationTime;this.drawCornerPattern(e,50,50,t),this.drawCornerPattern(e,j.WIDTH-50,50,t+Math.PI),this.drawCornerPattern(e,50,j.HEIGHT-50,t+Math.PI/2),this.drawCornerPattern(e,j.WIDTH-50,j.HEIGHT-50,t+1.5*Math.PI)}drawCornerPattern(e,t,s,i){for(let n=0;n<3;n++){const a=15*(n+1),o=.4-.1*n,r=i+.5*n;e.strokeStyle=`rgba(255, 255, 255, ${o})`,e.lineWidth=2,e.beginPath(),e.arc(t,s,a,r,r+Math.PI),e.stroke()}}drawMobileHint(e){if("ontouchstart"in window&&this.introAnimationComplete){e.save(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="16px Arial",e.textAlign="center";const t=.5+.3*Math.sin(.003*this.backgroundAnimationTime);e.globalAlpha=t,e.fillText("Tap anywhere to start!",j.WIDTH/2,j.HEIGHT-30),e.restore()}}updateHighScore(){const e=this.getHighScore();this.highScoreLabel&&this.highScoreLabel.setText(`High Score: ${e}`)}}Be=function*(){yield $.start({width:1e3,height:800,targetFPS:60,scenes:[new ke,new Ne,new le],preloadAssets:{images:[{name:R.IMAGES.BACKGROUND.GAMEPLAY_BACKGROUND,url:"assets/images/background/gameplay_background.png"},{name:R.IMAGES.BACKGROUND.MAINMENU_BACKGROUND,url:"assets/images/background/main_menu_background.png"},{name:R.IMAGES.BACKGROUND.PAUSE_PANEL_BACKGROUND,url:"assets/images/background/pause_panel_background.png"},{name:R.IMAGES.CLOUD,url:"assets/images/decoration/cloud.png"},{name:R.IMAGES.GROUND,url:"assets/images/platform/ground.png"},{name:R.IMAGES.PLATFORMS.PLATFORM_1,url:"assets/images/platform/platform_1.png"},{name:R.IMAGES.PLATFORMS.PLATFORM_2,url:"assets/images/platform/platform_2.png"},{name:R.IMAGES.PLATFORMS.PLATFORM_3,url:"assets/images/platform/platform_3.png"},{name:R.IMAGES.PLATFORMS.PLATFORM_4,url:"assets/images/platform/platform_4.png"},{name:R.IMAGES.PLATFORMS.PLATFORM_5,url:"assets/images/platform/platform_5.png"},{name:R.IMAGES.BREAKABLE_PLATFORM,url:"assets/images/platform/breakable_platform.png"},{name:R.IMAGES.BROKEN_PLATFORM,url:"assets/images/platform/broken_platform.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE+"_1",url:"assets/images/player/idle/player_idle_1.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE+"_2",url:"assets/images/player/idle/player_idle_2.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE+"_3",url:"assets/images/player/idle/player_idle_3.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE+"_4",url:"assets/images/player/idle/player_idle_4.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE+"_5",url:"assets/images/player/idle/player_idle_5.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE+"_6",url:"assets/images/player/idle/player_idle_6.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE_JETPACK+"_1",url:"assets/images/player/jetpack/idle/player_idle_jetpack_1.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE_JETPACK+"_2",url:"assets/images/player/jetpack/idle/player_idle_jetpack_2.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE_JETPACK+"_3",url:"assets/images/player/jetpack/idle/player_idle_jetpack_3.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE_JETPACK+"_4",url:"assets/images/player/jetpack/idle/player_idle_jetpack_4.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE_JETPACK+"_5",url:"assets/images/player/jetpack/idle/player_idle_jetpack_5.png"},{name:R.IMAGES.PLAYERS.PLAYER_IDLE_JETPACK+"_6",url:"assets/images/player/jetpack/idle/player_idle_jetpack_6.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_LEFT+"_1",url:"assets/images/player/move_left/player_move_left_1.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_LEFT+"_2",url:"assets/images/player/move_left/player_move_left_2.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_LEFT+"_3",url:"assets/images/player/move_left/player_move_left_3.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_LEFT+"_4",url:"assets/images/player/move_left/player_move_left_4.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_LEFT_JETPACK+"_1",url:"assets/images/player/jetpack/move_left/player_move_left_jetpack_1.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_LEFT_JETPACK+"_2",url:"assets/images/player/jetpack/move_left/player_move_left_jetpack_2.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_LEFT_JETPACK+"_3",url:"assets/images/player/jetpack/move_left/player_move_left_jetpack_3.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_LEFT_JETPACK+"_4",url:"assets/images/player/jetpack/move_left/player_move_left_jetpack_4.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_RIGHT+"_1",url:"assets/images/player/move_right/player_move_right_1.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_RIGHT+"_2",url:"assets/images/player/move_right/player_move_right_2.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_RIGHT+"_3",url:"assets/images/player/move_right/player_move_right_3.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_RIGHT+"_4",url:"assets/images/player/move_right/player_move_right_4.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_RIGHT_JETPACK+"_1",url:"assets/images/player/jetpack/move_right/player_move_right_jetpack_1.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_RIGHT_JETPACK+"_2",url:"assets/images/player/jetpack/move_right/player_move_right_jetpack_2.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_RIGHT_JETPACK+"_3",url:"assets/images/player/jetpack/move_right/player_move_right_jetpack_3.png"},{name:R.IMAGES.PLAYERS.PLAYER_MOVE_RIGHT_JETPACK+"_4",url:"assets/images/player/jetpack/move_right/player_move_right_jetpack_4.png"},{name:R.IMAGES.PLAYERS.PLAYER_JUMP+"_1",url:"assets/images/player/jump/player_jump_1.png"},{name:R.IMAGES.PLAYERS.PLAYER_JUMP+"_2",url:"assets/images/player/jump/player_jump_2.png"},{name:R.IMAGES.PLAYERS.PLAYER_JUMP+"_3",url:"assets/images/player/jump/player_jump_3.png"},{name:R.IMAGES.PLAYERS.PLAYER_DEAD,url:"assets/images/player/dead/player_dead.png"},{name:R.IMAGES.PROJECTILE+"_1",url:"assets/images/projectile/projectile_1.png"},{name:R.IMAGES.PROJECTILE+"_2",url:"assets/images/projectile/projectile_2.png"},{name:R.IMAGES.PROJECTILE+"_3",url:"assets/images/projectile/projectile_3.png"},{name:R.IMAGES.PROJECTILE+"_4",url:"assets/images/projectile/projectile_4.png"},{name:R.IMAGES.PROJECTILE+"_5",url:"assets/images/projectile/projectile_5.png"},{name:R.OBSTACLES.LANDED_SPIKE.ICON,url:"assets/images/obstacle/landed_spike.png"},{name:R.OBSTACLES.FLYING_MONSTER.ICON,url:"assets/images/obstacle/flying_monster.png"},{name:R.OBSTACLES.WITCH.ICON,url:"assets/images/obstacle/witch.png"},{name:R.ITEMS.TRAMPOLINE.ICON,url:"assets/images/items/trampoline.png"},{name:R.ITEMS.JETPACK.ICON,url:"assets/images/items/jetpack.png"},{name:R.IMAGES.DECORATIONS.TREE_1,url:"assets/images/decoration/tree_1.png"},{name:R.IMAGES.DECORATIONS.TREE_2,url:"assets/images/decoration/tree_2.png"},{name:R.IMAGES.DECORATIONS.TREE_3,url:"assets/images/decoration/tree_3.png"},{name:R.IMAGES.DECORATIONS.TREE_4,url:"assets/images/decoration/tree_4.png"},{name:R.IMAGES.DECORATIONS.LAMP_POST_1,url:"assets/images/decoration/lamp_post_1.png"},{name:R.IMAGES.DECORATIONS.LAMP_POST_2,url:"assets/images/decoration/lamp_post_2.png"},{name:R.IMAGES.BUTTON.SOUND_ON_BUTTON,url:"assets/images/button/sound_on_button.png"},{name:R.IMAGES.BUTTON.SOUND_OFF_BUTTON,url:"assets/images/button/sound_off_button.png"},{name:R.IMAGES.BUTTON.SETTINGS_BUTTON,url:"assets/images/button/settings_button.png"},{name:R.IMAGES.BUTTON.RESUME_BUTTON,url:"assets/images/button/resume_button.png"},{name:R.IMAGES.BUTTON.RESTART_BUTTON,url:"assets/images/button/restart_button.png"},{name:R.IMAGES.BUTTON.BACK_BUTTON,url:"assets/images/button/back_button.png"}],audio:[{name:R.AUDIO.SFX.JUMP,url:"assets/audio/sfx/jump.mp3"},{name:R.AUDIO.SFX.TRAMPOLINE,url:"assets/audio/sfx/trampoline.m4a"},{name:R.AUDIO.SFX.JETPACK,url:"assets/audio/sfx/jetpack.mp3"},{name:R.AUDIO.SFX.WALK,url:"assets/audio/sfx/walk.mp3"},{name:R.AUDIO.SFX.BUTTON_CLICK,url:"assets/audio/sfx/button_click.mp3"},{name:R.AUDIO.MUSIC.BACKGROUND_MUSIC,url:"assets/audio/music/background_music.mp3"},{name:R.AUDIO.SFX.HIT,url:"assets/audio/sfx/hit.mp3"},{name:R.AUDIO.SFX.SHOOT,url:"assets/audio/sfx/shoot.mp3"},{name:R.AUDIO.SFX.PLATFORM_BREAK,url:"assets/audio/sfx/platform_break.mp3"},{name:R.AUDIO.SFX.DESTROY_OBSTACLE,url:"assets/audio/sfx/destroy_obstacle.mp3"}]}})},new((Ge=void 0)||(Ge=Promise))(function(e,t){function s(e){try{n(Be.next(e))}catch(e){t(e)}}function i(e){try{n(Be.throw(e))}catch(e){t(e)}}function n(t){var n;t.done?e(t.value):(n=t.value,n instanceof Ge?n:new Ge(function(e){e(n)})).then(s,i)}n((Be=Be.apply(void 0,[])).next())})})();